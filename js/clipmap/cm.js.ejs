/*global vec3: true, mat4: true */

define('clipmap/cm',
['underscore', 'glmatrix', 'ByteBuffer'],
function (_, glmatrix, ByteBuffer) {
	<%- include ../shared/shared.js %>
	<%- include cm-defines.js %>

	// We don't want everyone who requires us to 
	// have the same version of clipmap.
	function ClipMap(cominterface) {
		var com = cominterface;
		<%- include cm-bsp.js %>
		<%- include cm-test.js %>
		<%- include cm-trace.js %>

		return {
			LoadMap: LoadMap,
			EntityDefs: function () { return cm.entities; },
			InlineModel: InlineModel,
			ModelBounds: ModelBounds,
			BoxTrace: BoxTrace,
			TransformedBoxTrace: TransformedBoxTrace
		};
	}

	return {
		CreateInstance: function (cominterface) {
			return new ClipMap(cominterface);
		}
	};
});