//     Underscore.js 1.4.1
//     http://underscorejs.org
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/**
 * ByteBuffer v0.0.1
 * Copyright (c) 2012 Tim Kurvers <http://moonsphere.net>
 *
 * Wrapper for ArrayBuffer/DataView maintaining index and default endianness.
 * Supports arbitrary reading/writing, implicit growth, clipping, cloning and
 * reversing as well as UTF-8 characters and NULL-terminated C-strings.
 *
 * The contents of this file are subject to the MIT License, under which
 * this library is licensed. See the LICENSE file for the full license.
 */

/*
 * Copyright (c) 2012 Brandon Jones, Colin MacKenzie IV
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */

(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.1";var N=T.each=T.forEach=function(e,t,r){if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return p&&e.map===p?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;if(d&&e.reduce===d)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;if(v&&e.reduceRight===v)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return m&&e.filter===m?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){var r=[];return N(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return g&&e.every===g?e.every(t,r):(N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return y&&e.some===y?e.some(t,r):(N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};T.contains=T.include=function(e,t){var n=!1;return b&&e.indexOf===b?e.indexOf(t)!=-1:(n=C(e,function(e){return e===t}),n)},T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return N(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);return N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]},T.size=function(e){return e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return t!=null&&!n?u.call(e,0,t):e[0]},T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){return N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return A(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){var i=n?T.map(e,n,r):e,s=[],o=[];return N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n))o.push(n),s.push(e[r])}),s},T.union=function(){return T.uniq(a.apply(r,arguments))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){var r=0,i=e.length;if(n){if(typeof n!="number")return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o,u,a=T.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&(u=e.apply(n,r)),a()};return i||(i=setTimeout(f,t)),s?o=!0:(s=!0,u=e.apply(n,r)),a(),u}},T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},T.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType===1},T.isArray=E||function(e){return l.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")}),typeof /./!="function"&&(T.isFunction=function(e){return typeof e=="function"}),T.isFinite=function(e){return T.isNumber(e)&&isFinite(e)},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",i=u+t.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return T})}).call(this),function(e){var t;t=function(){function u(t,n,i,s){var o;t==null&&(t=0),n==null&&(n=r.BIG_ENDIAN),i==null&&(i=!1),s==null&&(s=!1),this._buffer=null,this._raw=null,this._view=null,this._order=!!n,this._implicitGrowth=!!s,this._index=0,o=e(t,i),o||(o=new ArrayBuffer(t)),this.buffer=o}var e,t,n,r,i,s,o=this;return u.LITTLE_ENDIAN=!0,u.BIG_ENDIAN=!1,r=u,t=function(e,t){return Object.defineProperty(u.prototype,e,{get:t,enumerable:!0,configurable:!0})},i=function(e,t){return Object.defineProperty(u.prototype,e,{set:t,enumerable:!0,configurable:!0})},u.prototype._sanitizeIndex=function(){this._index<0&&(this._index=0);if(this._index>this.length)return this._index=this.length},e=function(e,t){t==null&&(t=!1);if(e.byteLength!=null)return e.buffer!=null?t?e.buffer.slice(0):e.buffer:t?e.slice(0):e;if(e.length==null)return null;try{return(new Uint8Array(e)).buffer}catch(n){return null}},t("buffer",function(){return this._buffer}),i("buffer",function(e){return this._buffer=e,this._raw=new Uint8Array(this._buffer),this._view=new DataView(this._buffer),this._sanitizeIndex()}),t("raw",function(){return this._raw}),t("view",function(){return this._view}),t("length",function(){return this._buffer.byteLength}),t("byteLength",function(){return this.length}),t("order",function(){return this._order}),i("order",function(e){return this._order=!!e}),t("implicitGrowth",function(){return this._implicitGrowth}),i("implicitGrowth",function(e){return this._implicitGrowth=!!e}),t("index",function(){return this._index}),i("index",function(e){if(e<0||e>this.length)throw new RangeError("Invalid index "+e+", should be between 0 and "+this.length);return this._index=e}),u.prototype.front=function(){return this._index=0,this},u.prototype.end=function(){return this._index=this.length,this},u.prototype.seek=function(e){return e==null&&(e=1),this.index+=e,this},t("available",function(){return this.length-this._index}),n=function(e,t){return function(n){var r;n==null&&(n=this._order);if(t>this.available)throw new Error("Cannot read "+t+" byte(s), "+this.available+" available");return r=this._view[e](this._index,n),this._index+=t,r}},s=function(e,t){return function(n,r){var i;r==null&&(r=this._order),i=this.available;if(t>i){if(!this._implicitGrowth)throw new Error("Cannot write "+n+" using "+t+" byte(s), "+i+" available");this.append(t-i)}return this._view[e](this._index,n,r),this._index+=t,this}},u.prototype.readByte=n("getInt8",1),u.prototype.readUnsignedByte=n("getUint8",1),u.prototype.readShort=n("getInt16",2),u.prototype.readUnsignedShort=n("getUint16",2),u.prototype.readInt=n("getInt32",4),u.prototype.readUnsignedInt=n("getUint32",4),u.prototype.readFloat=n("getFloat32",4),u.prototype.readDouble=n("getFloat64",8),u.prototype.writeByte=s("setInt8",1),u.prototype.writeUnsignedByte=s("setUint8",1),u.prototype.writeShort=s("setInt16",2),u.prototype.writeUnsignedShort=s("setUint16",2),u.prototype.writeInt=s("setInt32",4),u.prototype.writeUnsignedInt=s("setUint32",4),u.prototype.writeFloat=s("setFloat32",4),u.prototype.writeDouble=s("setFloat64",8),u.prototype.read=function(e){var t;e==null&&(e=this.available);if(e>this.available)throw new Error("Cannot read "+e+" byte(s), "+this.available+" available");if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new r(this._buffer.slice(this._index,this._index+e)),this._index+=e,t},u.prototype.write=function(t){var n,r,i;if(t instanceof Uint8Array)i=t;else{r=e(t);if(!r)throw new TypeError("Cannot write "+t+", not a sequence");i=new Uint8Array(r)}n=this.available;if(i.byteLength>n){if(!this._implicitGrowth)throw new Error("Cannot write "+t+" using "+i.byteLength+" byte(s), "+this.available+" available");this.append(i.byteLength-n)}return this._raw.set(i,this._index),this._index+=i.byteLength,this},u.prototype.readString=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;e==null&&(e=this.available);if(e>this.available)throw new Error("Cannot read "+e+" byte(s), "+this.available+" available");if(e<=0)throw new RangeError("Invalid number of bytes "+e);h=this._raw,u=[],s=0,t=n=r=i=null,p=this._index+e;while(this._index<p){t=h[this._index];if(t<128)u[s++]=t,this._index++;else{if(t<194)throw new Error("Unexpected continuation byte");if(t<224){n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");u[s++]=((t&31)<<6)+(n&63),this._index+=2}else if(t<240){n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");r=h[this._index+2];if(r<128||r>191)throw new Error("Bad continuation byte");u[s++]=((t&15)<<12)+((n&63)<<6)+(r&63),this._index+=3}else{if(!(t<245))throw new Error("Illegal byte");n=h[this._index+1];if(n<128||n>191)throw new Error("Bad continuation byte");r=h[this._index+2];if(r<128||r>191)throw new Error("Bad continuation byte");i=h[this._index+3];if(i<128||i>191)throw new Error("Bad continuation byte");a=((t&7)<<18)+((n&63)<<12)+((r&63)<<6)+(i&63),a-=65536,u[s++]=55296+((a&1047552)>>>10),u[s++]=56320+(a&1023),this._index+=4}}}c=65536,l=u.length;if(l<c)return String.fromCharCode.apply(String,u);o=[],f=0;while(f<l)o.push(String.fromCharCode.apply(String,u.slice(f,f+c))),f+=c;return o.join("")},u.prototype.writeString=function(e){var t,n,r,i,s,o,u;n=[],u=e.length,o=0,t=0;while(o<u){r=e.charCodeAt(o);if(r<=127)n[t++]=r;else if(r<=2047)n[t++]=192|(r&1984)>>>6,n[t++]=128|r&63;else if(r<=55295||r>=57344&&r<=65535)n[t++]=224|(r&61440)>>>12,n[t++]=128|(r&4032)>>>6,n[t++]=128|r&63;else{if(o===u-1)throw new Error("Unpaired surrogate "+e[o]+" (index "+o+")");s=e.charCodeAt(++o);if(r<55296||r>56319||s<56320||s>57343)throw new Error("Unpaired surrogate "+e[o]+" (index "+o+")");i=((r&1023)<<10)+(s&1023)+65536,n[t++]=240|(i&1835008)>>>18,n[t++]=128|(i&258048)>>>12,n[t++]=128|(i&4032)>>>6,n[t++]=128|i&63}++o}return this.write(n),n.length},u.prototype.readUTFChars=u.prototype.readString,u.prototype.writeUTFChars=u.prototype.writeString,u.prototype.readCString=function(){var e,t,n,r;e=this._raw,n=e.length,t=this._index;while(e[t]!==0&&t<n)++t;return n=t-this._index,n>0?(r=this.readString(n),this.readByte(),r):null},u.prototype.writeCString=function(e){var t;return t=this.writeString(e),this.writeByte(0),++t},u.prototype.readASCIIString=function(e){var t,n,r,i,s;if(e>this.available)throw new Error("Cannot read "+e+" byte(s), "+this.available+" available");if(e<=0)throw new RangeError("Invalid number of bytes "+e);t=0,i=[];while(t<e)n=this.readByte(),n!==0&&(i[t]=n),t++;r=65536;if(e<r)return String.fromCharCode.apply(String,i);s=[],t=0;while(t<e)s.push(String.fromCharCode.apply(String,i.slice(t,t+r))),t+=r;return s.join("")},u.prototype.writeASCIIString=function(e,t){var n,r,i,s;n=this._raw,r=0,i=t||e.length,s=[];while(r<i)s[r++]=r<e.length?e.charCodeAt(r):0;return this.write(s),i},u.prototype.prepend=function(e){var t;if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new Uint8Array(this.length+e),t.set(this._raw,e),this._index+=e,this.buffer=t.buffer,this},u.prototype.append=function(e){var t;if(e<=0)throw new RangeError("Invalid number of bytes "+e);return t=new Uint8Array(this.length+e),t.set(this._raw,0),this.buffer=t.buffer,this},u.prototype.clip=function(e,t){var n;return e==null&&(e=this._index),t==null&&(t=this.length),e<0&&(e=this.length+e),n=this._buffer.slice(e,t),this._index-=e,this.buffer=n,this},u.prototype.slice=function(e,t){var n;return e==null&&(e=0),t==null&&(t=this.length),n=new r(this._buffer.slice(e,t)),n},u.prototype.clone=function(){var e;return e=new r(this._buffer.slice(0)),e.index=this._index,e},u.prototype.reverse=function(){return Array.prototype.reverse.call(this._raw),this._index=0,this},u.prototype.toArray=function(){return Array.prototype.slice.call(this._raw,0)},u.prototype.toString=function(){var e;return e=this._order===r.BIG_ENDIAN?"big-endian":"little-endian","[ByteBuffer; Order: "+e+"; Length: "+this.length+"; Index: "+this._index+"; Available: "+this.available+"]"},u.prototype.toHex=function(e){return e==null&&(e=" "),Array.prototype.map.call(this._raw,function(e){return("00"+e.toString(16).toUpperCase()).slice(-2)}).join(e)},u.prototype.toASCII=function(e,t,n){var r;return e==null&&(e=" "),t==null&&(t=!0),n==null&&(n="�"),r=t?" ":"",Array.prototype.map.call(this._raw,function(e){return e<32||e>126?r+n:r+String.fromCharCode(e)}).join(e)},u}.call(this),typeof define=="function"&&define.amd?define("ByteBuffer",[],function(){return t}):e.ByteBuffer=t}(this),function(e,t){typeof exports=="object"?module.exports=t(global):typeof define=="function"&&define.amd?define("glmatrix",[],function(){return t(e)}):t(e)}(this,function(e){function i(e){return r=e,r}function s(){return r=typeof Float32Array!="undefined"?Float32Array:Array,r}var t=1e-6,n={};(function(){if(typeof Float32Array!="undefined"){var e=new Float32Array(1),t=new Int32Array(e.buffer);n.invsqrt=function(n){var r=n*.5;e[0]=n;var i=1.5;t[0]=1597463007-(t[0]>>1);var s=e[0];return s*(i-r*s*s)}}else n.invsqrt=function(e){return 1/Math.sqrt(e)}})();var r=null;s();var o={};o.create=function(e){var t=new r(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},o.createFrom=function(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i},o.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t},o.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n)},o.subtract=function(e,t,n){return!n||e===n?(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e):(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n)},o.multiply=function(e,t,n){return!n||e===n?(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e):(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n)},o.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e[2]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n)},o.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=Math.sqrt(n*n+r*r+i*i);return s?s===1?(t[0]=n,t[1]=r,t[2]=i,t):(s=1/s,t[0]=n*s,t[1]=r*s,t[2]=i*s,t):(t[0]=0,t[1]=0,t[2]=0,t)},o.cross=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2];return n[0]=i*a-s*u,n[1]=s*o-r*a,n[2]=r*u-i*o,n},o.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},o.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],o=Math.sqrt(r*r+i*i+s*s);return o?(o=1/o,n[0]=r*o,n[1]=i*o,n[2]=s*o,n):(n[0]=0,n[1]=0,n[2]=0,n)},o.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r},o.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)};var u=null,a=new r(4);o.unproject=function(e,t,n,r,i){i||(i=e),u||(u=d.create());var s=u,o=a;return o[0]=(e[0]-r[0])*2/r[2]-1,o[1]=(e[1]-r[1])*2/r[3]-1,o[2]=2*e[2]-1,o[3]=1,d.multiply(n,t,s),d.inverse(s)?(d.multiplyVec4(s,o),o[3]===0?null:(i[0]=o[0]/o[3],i[1]=o[1]/o[3],i[2]=o[2]/o[3],i)):null};var f=o.createFrom(1,0,0),l=o.createFrom(0,1,0),c=o.createFrom(0,0,1),h=o.create();o.rotationTo=function(e,t,n){n||(n=v.create());var r=o.dot(e,t),i=h;if(r>=1)v.set(m,n);else if(r<1e-6-1)o.cross(f,e,i),o.length(i)<1e-6&&o.cross(l,e,i),o.length(i)<1e-6&&o.cross(c,e,i),o.normalize(i),v.fromAngleAxis(Math.PI,i,n);else{var s=Math.sqrt((1+r)*2),u=1/s;o.cross(e,t,i),n[0]=i[0]*u,n[1]=i[1]*u,n[2]=i[2]*u,n[3]=s*.5,v.normalize(n)}return n[3]>1?n[3]=1:n[3]<-1&&(n[3]=-1),n},o.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var p={};p.create=function(e){var t=new r(9);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]):t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=0,t},p.createFrom=function(e,t,n,i,s,o,u,a,f){var l=new r(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=s,l[5]=o,l[6]=u,l[7]=a,l[8]=f,l},p.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},p.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=l*o-u*f,h=-l*s+u*a,d=f*s-o*a,v=n*c+r*h+i*d,m;return v?(m=1/v,t||(t=p.create()),t[0]=c*m,t[1]=(-l*r+i*f)*m,t[2]=(u*r-i*o)*m,t[3]=h*m,t[4]=(l*n-i*a)*m,t[5]=(-u*n+i*s)*m,t[6]=d*m,t[7]=(-f*n+r*a)*m,t[8]=(o*n-r*s)*m,t):null},p.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],g=t[5],y=t[6],b=t[7],w=t[8];return n[0]=h*r+p*o+d*f,n[1]=h*i+p*u+d*l,n[2]=h*s+p*a+d*c,n[3]=v*r+m*o+g*f,n[4]=v*i+m*u+g*l,n[5]=v*s+m*a+g*c,n[6]=y*r+b*o+w*f,n[7]=y*i+b*u+w*l,n[8]=y*s+b*a+w*c,n},p.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[3]+e[6],n[1]=r*e[1]+i*e[4]+e[7],n},p.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2];return n[0]=r*e[0]+i*e[3]+s*e[6],n[1]=r*e[1]+i*e[4]+s*e[7],n[2]=r*e[2]+i*e[5]+s*e[8],n},p.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},p.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t&&Math.abs(e[3]-n[3])<t&&Math.abs(e[4]-n[4])<t&&Math.abs(e[5]-n[5])<t&&Math.abs(e[6]-n[6])<t&&Math.abs(e[7]-n[7])<t&&Math.abs(e[8]-n[8])<t},p.identity=function(e){return e||(e=p.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},p.toMat4=function(e,t){return t||(t=d.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},p.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var d={};d.create=function(e){var t=new r(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},d.createFrom=function(e,t,n,i,s,o,u,a,f,l,c,h,p,d,v,m){var g=new r(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=i,g[4]=s,g[5]=o,g[6]=u,g[7]=a,g[8]=f,g[9]=l,g[10]=c,g[11]=h,g[12]=p,g[13]=d,g[14]=v,g[15]=m,g},d.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},d.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t&&Math.abs(e[3]-n[3])<t&&Math.abs(e[4]-n[4])<t&&Math.abs(e[5]-n[5])<t&&Math.abs(e[6]-n[6])<t&&Math.abs(e[7]-n[7])<t&&Math.abs(e[8]-n[8])<t&&Math.abs(e[9]-n[9])<t&&Math.abs(e[10]-n[10])<t&&Math.abs(e[11]-n[11])<t&&Math.abs(e[12]-n[12])<t&&Math.abs(e[13]-n[13])<t&&Math.abs(e[14]-n[14])<t&&Math.abs(e[15]-n[15])<t},d.identity=function(e){return e||(e=d.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},d.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},d.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return p*l*u*i-f*d*u*i-p*o*c*i+s*d*c*i+f*o*v*i-s*l*v*i-p*l*r*a+f*d*r*a+p*n*c*a-t*d*c*a-f*n*v*a+t*l*v*a+p*o*r*h-s*d*r*h-p*n*u*h+t*d*u*h+s*n*v*h-t*o*v*h-f*o*r*m+s*l*r*m+f*n*u*m-t*l*u*m-s*n*c*m+t*o*c*m},d.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T,M;return O?(M=1/O,t[0]=(u*A-a*L+f*k)*M,t[1]=(-r*A+i*L-s*k)*M,t[2]=(v*x-m*S+g*E)*M,t[3]=(-c*x+h*S-p*E)*M,t[4]=(-o*A+a*C-f*N)*M,t[5]=(n*A-i*C+s*N)*M,t[6]=(-d*x+m*w-g*b)*M,t[7]=(l*x-h*w+p*b)*M,t[8]=(o*L-u*C+f*T)*M,t[9]=(-n*L+r*C-s*T)*M,t[10]=(d*S-v*w+g*y)*M,t[11]=(-l*S+c*w-p*y)*M,t[12]=(-o*k+u*N-a*T)*M,t[13]=(n*k-r*N+i*T)*M,t[14]=(-d*E+v*b-m*y)*M,t[15]=(l*E-c*b+h*y)*M,t):null},d.toRotationMat=function(e,t){return t||(t=d.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},d.toMat3=function(e,t){return t||(t=p.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},d.toInverseMat3=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],u=e[6],a=e[8],f=e[9],l=e[10],c=l*o-u*f,h=-l*s+u*a,d=f*s-o*a,v=n*c+r*h+i*d,m;return v?(m=1/v,t||(t=p.create()),t[0]=c*m,t[1]=(-l*r+i*f)*m,t[2]=(u*r-i*o)*m,t[3]=h*m,t[4]=(l*n-i*a)*m,t[5]=(-u*n+i*s)*m,t[6]=d*m,t[7]=(-f*n+r*a)*m,t[8]=(o*n-r*s)*m,t):null},d.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=t[0],w=t[1],E=t[2],S=t[3];return n[0]=b*r+w*u+E*c+S*v,n[1]=b*i+w*a+E*h+S*m,n[2]=b*s+w*f+E*p+S*g,n[3]=b*o+w*l+E*d+S*y,b=t[4],w=t[5],E=t[6],S=t[7],n[4]=b*r+w*u+E*c+S*v,n[5]=b*i+w*a+E*h+S*m,n[6]=b*s+w*f+E*p+S*g,n[7]=b*o+w*l+E*d+S*y,b=t[8],w=t[9],E=t[10],S=t[11],n[8]=b*r+w*u+E*c+S*v,n[9]=b*i+w*a+E*h+S*m,n[10]=b*s+w*f+E*p+S*g,n[11]=b*o+w*l+E*d+S*y,b=t[12],w=t[13],E=t[14],S=t[15],n[12]=b*r+w*u+E*c+S*v,n[13]=b*i+w*a+E*h+S*m,n[14]=b*s+w*f+E*p+S*g,n[15]=b*o+w*l+E*d+S*y,n},d.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12],n[1]=e[1]*r+e[5]*i+e[9]*s+e[13],n[2]=e[2]*r+e[6]*i+e[10]*s+e[14],n},d.multiplyVec4=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=t[3];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12]*o,n[1]=e[1]*r+e[5]*i+e[9]*s+e[13]*o,n[2]=e[2]*r+e[6]*i+e[10]*s+e[14]*o,n[3]=e[3]*r+e[7]*i+e[11]*s+e[15]*o,n},d.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o,u,a,f,l,c,h,p,d,v,m,g;return!n||e===n?(e[12]=e[0]*r+e[4]*i+e[8]*s+e[12],e[13]=e[1]*r+e[5]*i+e[9]*s+e[13],e[14]=e[2]*r+e[6]*i+e[10]*s+e[14],e[15]=e[3]*r+e[7]*i+e[11]*s+e[15],e):(o=e[0],u=e[1],a=e[2],f=e[3],l=e[4],c=e[5],h=e[6],p=e[7],d=e[8],v=e[9],m=e[10],g=e[11],n[0]=o,n[1]=u,n[2]=a,n[3]=f,n[4]=l,n[5]=c,n[6]=h,n[7]=p,n[8]=d,n[9]=v,n[10]=m,n[11]=g,n[12]=o*r+l*i+d*s+e[12],n[13]=u*r+c*i+v*s+e[13],n[14]=a*r+h*i+m*s+e[14],n[15]=f*r+p*i+g*s+e[15],n)},d.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2];return!n||e===n?(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=s,e[9]*=s,e[10]*=s,e[11]*=s,e):(n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)},d.rotate=function(e,t,n,r){var i=n[0],s=n[1],o=n[2],u=Math.sqrt(i*i+s*s+o*o),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;return u?(u!==1&&(u=1/u,i*=u,s*=u,o*=u),a=Math.sin(t),f=Math.cos(t),l=1-f,c=e[0],h=e[1],p=e[2],d=e[3],v=e[4],m=e[5],g=e[6],y=e[7],b=e[8],w=e[9],E=e[10],S=e[11],x=i*i*l+f,T=s*i*l+o*a,N=o*i*l-s*a,C=i*s*l-o*a,k=s*s*l+f,L=o*s*l+i*a,A=i*o*l+s*a,O=s*o*l-i*a,M=o*o*l+f,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=c*x+v*T+b*N,r[1]=h*x+m*T+w*N,r[2]=p*x+g*T+E*N,r[3]=d*x+y*T+S*N,r[4]=c*C+v*k+b*L,r[5]=h*C+m*k+w*L,r[6]=p*C+g*k+E*L,r[7]=d*C+y*k+S*L,r[8]=c*A+v*O+b*M,r[9]=h*A+m*O+w*M,r[10]=p*A+g*O+E*M,r[11]=d*A+y*O+S*M,r):null},d.rotateX=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[4]=s*i+f*r,n[5]=o*i+l*r,n[6]=u*i+c*r,n[7]=a*i+h*r,n[8]=s*-r+f*i,n[9]=o*-r+l*i,n[10]=u*-r+c*i,n[11]=a*-r+h*i,n},d.rotateY=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*-r,n[1]=o*i+l*-r,n[2]=u*i+c*-r,n[3]=a*i+h*-r,n[8]=s*r+f*i,n[9]=o*r+l*i,n[10]=u*r+c*i,n[11]=a*r+h*i,n},d.rotateZ=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7];return n?e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*r,n[1]=o*i+l*r,n[2]=u*i+c*r,n[3]=a*i+h*r,n[4]=s*-r+f*i,n[5]=o*-r+l*i,n[6]=u*-r+c*i,n[7]=a*-r+h*i,n},d.frustum=function(e,t,n,r,i,s,o){o||(o=d.create());var u=t-e,a=r-n,f=s-i;return o[0]=i*2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i*2/a,o[6]=0,o[7]=0,o[8]=(t+e)/u,o[9]=(r+n)/a,o[10]=-(s+i)/f,o[11]=-1,o[12]=0,o[13]=0,o[14]=-(s*i*2)/f,o[15]=0,o},d.perspective=function(e,t,n,r,i){var s=n*Math.tan(e*Math.PI/360),o=s*t;return d.frustum(-o,o,-s,s,n,r,i)},d.ortho=function(e,t,n,r,i,s,o){o||(o=d.create());var u=t-e,a=r-n,f=s-i;return o[0]=2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/f,o[11]=0,o[12]=-(e+t)/u,o[13]=-(r+n)/a,o[14]=-(s+i)/f,o[15]=1,o},d.lookAt=function(e,t,n,r){r||(r=d.create());var i,s,o,u,a,f,l,c,h,p,v=e[0],m=e[1],g=e[2],y=n[0],b=n[1],w=n[2],E=t[0],S=t[1],x=t[2];return v===E&&m===S&&g===x?d.identity(r):(l=v-E,c=m-S,h=g-x,p=1/Math.sqrt(l*l+c*c+h*h),l*=p,c*=p,h*=p,i=b*h-w*c,s=w*l-y*h,o=y*c-b*l,p=Math.sqrt(i*i+s*s+o*o),p?(p=1/p,i*=p,s*=p,o*=p):(i=0,s=0,o=0),u=c*o-h*s,a=h*i-l*o,f=l*s-c*i,p=Math.sqrt(u*u+a*a+f*f),p?(p=1/p,u*=p,a*=p,f*=p):(u=0,a=0,f=0),r[0]=i,r[1]=u,r[2]=l,r[3]=0,r[4]=s,r[5]=a,r[6]=c,r[7]=0,r[8]=o,r[9]=f,r[10]=h,r[11]=0,r[12]=-(i*v+s*m+o*g),r[13]=-(u*v+a*m+f*g),r[14]=-(l*v+c*m+h*g),r[15]=1,r)},d.fromRotationTranslation=function(e,t,n){n||(n=d.create());var r=e[0],i=e[1],s=e[2],o=e[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,v=i*f,m=s*f,g=o*u,y=o*a,b=o*f;return n[0]=1-(p+m),n[1]=c+b,n[2]=h-y,n[3]=0,n[4]=c-b,n[5]=1-(l+m),n[6]=v+g,n[7]=0,n[8]=h+y,n[9]=v-g,n[10]=1-(l+p),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},d.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var v={};v.create=function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},v.createFrom=function(e,t,n,i){var s=new r(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s},v.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},v.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t&&Math.abs(e[3]-n[3])<t},v.identity=function(e){return e||(e=v.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var m=v.identity();v.calculateW=function(e,t){var n=e[0],r=e[1],i=e[2];return!t||e===t?(e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e):(t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t)},v.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},v.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return!t||e===t?(e[0]*=-u,e[1]*=-u,e[2]*=-u,e[3]*=u,e):(t[0]=-e[0]*u,t[1]=-e[1]*u,t[2]=-e[2]*u,t[3]=e[3]*u,t)},v.conjugate=function(e,t){return!t||e===t?(e[0]*=-1,e[1]*=-1,e[2]*=-1,e):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t)},v.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},v.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i+s*s);return o===0?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(o=1/o,t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t)},v.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n)},v.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=t[0],a=t[1],f=t[2],l=t[3];return n[0]=r*l+o*u+i*f-s*a,n[1]=i*l+o*a+s*u-r*f,n[2]=s*l+o*f+r*a-i*u,n[3]=o*l-r*u-i*a-s*f,n},v.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=e[0],u=e[1],a=e[2],f=e[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return n[0]=l*f+p*-o+c*-a-h*-u,n[1]=c*f+p*-u+h*-o-l*-a,n[2]=h*f+p*-a+l*-u-c*-o,n},v.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n)},v.toMat3=function(e,t){t||(t=p.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,d=r*a,v=i*a,m=s*o,g=s*u,y=s*a;return t[0]=1-(h+v),t[1]=l+y,t[2]=c-g,t[3]=l-y,t[4]=1-(f+v),t[5]=d+m,t[6]=c+g,t[7]=d-m,t[8]=1-(f+h),t},v.toMat4=function(e,t){t||(t=d.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,v=i*a,m=s*o,g=s*u,y=s*a;return t[0]=1-(h+v),t[1]=l+y,t[2]=c-g,t[3]=0,t[4]=l-y,t[5]=1-(f+v),t[6]=p+m,t[7]=0,t[8]=c+g,t[9]=p-m,t[10]=1-(f+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},v.slerp=function(e,t,n,r){r||(r=e);var i=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],s,o,u,a;return Math.abs(i)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(s=Math.acos(i),o=Math.sqrt(1-i*i),Math.abs(o)<.001?(r[0]=e[0]*.5+t[0]*.5,r[1]=e[1]*.5+t[1]*.5,r[2]=e[2]*.5+t[2]*.5,r[3]=e[3]*.5+t[3]*.5,r):(u=Math.sin((1-n)*s)/o,a=Math.sin(n*s)/o,r[0]=e[0]*u+t[0]*a,r[1]=e[1]*u+t[1]*a,r[2]=e[2]*u+t[2]*a,r[3]=e[3]*u+t[3]*a,r))},v.fromRotationMatrix=function(e,t){t||(t=v.create());var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[7]-e[5])*r,t[1]=(e[2]-e[6])*r,t[2]=(e[3]-e[1])*r;else{var i=v.fromRotationMatrix.s_iNext=v.fromRotationMatrix.s_iNext||[1,2,0],s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var o=i[s],u=i[o];r=Math.sqrt(e[s*3+s]-e[o*3+o]-e[u*3+u]+1),t[s]=.5*r,r=.5/r,t[3]=(e[u*3+o]-e[o*3+u])*r,t[o]=(e[o*3+s]+e[s*3+o])*r,t[u]=(e[u*3+s]+e[s*3+u])*r}return t},p.toQuat4=v.fromRotationMatrix,function(){var e=p.create();v.fromAxes=function(t,n,r,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=t[0],e[5]=t[1],e[8]=t[2],v.fromRotationMatrix(e,i)}}(),v.identity=function(e){return e||(e=v.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},v.fromAngleAxis=function(e,t,n){n||(n=v.create());var r=e*.5,i=Math.sin(r);return n[3]=Math.cos(r),n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n},v.toAngleAxis=function(e,t){t||(t=e);var r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){t[3]=2*Math.acos(e[3]);var i=n.invsqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},v.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var g={};g.create=function(e){var t=new r(2);return e?(t[0]=e[0],t[1]=e[1]):(t[0]=0,t[1]=0),t},g.createFrom=function(e,t){var n=new r(2);return n[0]=e,n[1]=t,n},g.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},g.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},g.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n},g.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n},g.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},g.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},g.set=function(e,t){return t[0]=e[0],t[1]=e[1],t},g.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t},g.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t},g.normalize=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1];return n>0?(n=Math.sqrt(n),t[0]=e[0]/n,t[1]=e[1]/n):t[0]=t[1]=0,t},g.cross=function(e,t,n){var r=e[0]*t[1]-e[1]*t[0];return n?(n[0]=n[1]=0,n[2]=r,n):r},g.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},g.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},g.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},g.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],s=r*r+i*i;return s?(s=1/Math.sqrt(s),n[0]=r*s,n[1]=i*s,n):(n[0]=0,n[1]=0,n[2]=0,n)},g.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r},g.str=function(e){return"["+e[0]+", "+e[1]+"]"};var y={};y.create=function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},y.createFrom=function(e,t,n,i){var s=new r(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s},y.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},y.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t&&Math.abs(e[3]-n[3])<t},y.identity=function(e){return e||(e=y.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},y.transpose=function(e,t){if(!t||e===t){var n=e[1];return e[1]=e[2],e[2]=n,e}return t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t},y.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},y.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=n*s-i*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null},y.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3];return n[0]=r*t[0]+i*t[2],n[1]=r*t[1]+i*t[3],n[2]=s*t[0]+o*t[2],n[3]=s*t[1]+o*t[3],n},y.rotate=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=Math.sin(t),a=Math.cos(t);return n[0]=r*a+i*u,n[1]=r*-u+i*a,n[2]=s*a+o*u,n[3]=s*-u+o*a,n},y.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[1],n[1]=r*e[2]+i*e[3],n},y.scale=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=t[0],a=t[1];return n[0]=r*u,n[1]=i*a,n[2]=s*u,n[3]=o*a,n},y.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var b={};return b.create=function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},b.createFrom=function(e,t,n,i){var s=new r(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s},b.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},b.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},b.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},b.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},b.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},b.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},b.equal=function(e,n){return e===n||Math.abs(e[0]-n[0])<t&&Math.abs(e[1]-n[1])<t&&Math.abs(e[2]-n[2])<t&&Math.abs(e[3]-n[3])<t},b.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},b.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},b.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},b.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r[3]=e[3]+n*(t[3]-e[3]),r},b.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},e&&(e.glMatrixArrayType=r,e.MatrixArray=r,e.setMatrixArrayType=i,e.determineMatrixArrayType=s,e.glMath=n,e.vec2=g,e.vec3=o,e.vec4=b,e.mat2=y,e.mat3=p,e.mat4=d,e.quat4=v),{glMatrixArrayType:r,MatrixArray:r,setMatrixArrayType:i,determineMatrixArrayType:s,glMath:n,vec2:g,vec3:o,vec4:b,mat2:y,mat3:p,mat4:d,quat4:v}}),define("game/bg",["glmatrix"],function(e){function M(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function _(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function D(e,t,n){n[0]=_(e[0],t[0]),n[1]=_(e[1],t[1]),n[2]=_(e[2],t[2])}function P(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function H(e,t,n,r){var i,s,o,u,a,f,l;i=e[A]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[L]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[O]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function B(e,t){var n=[0,0,0];H(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function j(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function F(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function V(e){return e[0]==1?R:e[1]==1?U:e[2]==1?z:W}function $(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function J(e,t,n){if(n.type<W)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function Q(e,t,n){var r=new Array(n),i=[].concat(K),s=[].concat(K),o=[].concat(K),u=[].concat(K),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function ht(e){return e<-128?-128:e>127?127:e}function pt(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function Pt(e,t){t.number=e.clientNum,t.eType=kt.PLAYER,t.pos.trType=T.INTERPOLATE,vec3.set(e.origin,t.pos.trBase),vec3.set(e.velocity,t.pos.trDelta),t.apos.trType=T.INTERPOLATE,vec3.set(e.viewangles,t.apos.trBase),t.angles2[A]=e.movementDir,t.legsAnim=e.legsAnim,t.torsoAnim=e.torsoAnim,t.clientNum=e.clientNum,t.eFlags=e.eFlags,t.groundEntityNum=e.groundEntityNum}function Ht(e,t,n){var i,s;switch(e.trType){case T.STATIONARY:case T.INTERPOLATE:vec3.set(e.trBase,n);break;case T.LINEAR:i=(t-e.trTime)*.001,vec3.add(e.trBase,vec3.scale(e.trDelta,i),n);break;case T.SINE:i=(t-e.trTime)/e.trDuration,s=Math.sin(i*Math.PI*2),vec3.add(e.trBase,s,e.trDelta,n);break;case T.LINEAR_STOP:t>e.trTime+e.trDuration&&(t=e.trTime+e.trDuration),i=(t-e.trTime)*.001,i<0&&(i=0),vec3.add(e.trBase,vec3.scale(e.trDelta,i),n);break;case T.GRAVITY:i=(t-e.trTime)*.001,vec3.add(e.trBase,vec3.scale(e.trDelta,i),n),n[2]-=.5*dt*i*i;break;default:com.error(r.DROP,"EvaluateTrajectory: unknown trType: "+e.trType)}}function Bt(e,t){e.jumppad_ent=t.number,e.jumppad_frame=e.pmove_framecount,vec3.set(t.origin2,e.velocity)}function Zt(e,t){var n=e.ps;if(n.pm_type>=Mt.DEAD)return;n.torsoAnim=n.torsoAnim&Tt^Tt|t}function en(e,t){var n=e.ps;if(n.pm_type>=Mt.DEAD)return;if(n.legsTimer>0)return;n.legsAnim=n.legsAnim&Tt^Tt|t}function tn(e,t){var n=e.ps;if((n.legsAnim&~Tt)===t)return;if(n.legsTimer>0)return;en(e,t)}function nn(e,t){var n=e.ps;if((n.torsoAnim&~Tt)===t)return;if(n.torsoTimer>0)return;Zt(e,t)}function rn(e,t){var n=e.ps;n.legsTimer=0,en(e,t)}function sn(e,t){var n=Math.abs(e.forwardmove);Math.abs(e.rightmove)>n&&(n=Math.abs(e.rightmove)),Math.abs(e.upmove)>n&&(n=Math.abs(e.upmove));if(!n)return 0;var r=Math.sqrt(e.forwardmove*e.forwardmove+e.rightmove*e.rightmove+e.upmove*e.upmove),i=t*n/(127*r);return i}function on(e,t){var n=e.ps,r=vec3.create(n.velocity);Gt&&(r[2]=0);var i=vec3.length(r);if(i<1){n.velocity[0]=0,n.velocity[1]=0;return}var s=0;if(Gt&&!(Kt.surfaceFlags&G.SLICK)&&!(n.pm_flags&_t.TIME_KNOCKBACK)){var o=i<jt?jt:i;s+=o*zt*e.frameTime}t&&(s+=i*Wt*e.frameTime);var u=i-s;u<0&&(u=0),u/=i,vec3.scale(n.velocity,u)}function un(e,t,n){var r=vec3.dot(e,t);r<0?r*=n:r/=n;var i=vec3.scale(t,r,[0,0,0]);return vec3.subtract(e,i,[0,0,0])}function an(e,t,n,r){var i=e.ps,s=vec3.dot(i.velocity,t),o=n-s;if(o<=0)return;var u=r*e.frameTime*n;u>o&&(u=o),vec3.add(i.velocity,vec3.scale(t,u,[0,0,0]))}function fn(e){e.mins[0]=-15,e.mins[1]=-15,e.mins[2]=-24,e.maxs[0]=15,e.maxs[1]=15,e.maxs[2]=32,e.ps.viewheight=wt}function ln(e){var t=e.ps;return e.cmd.upmove<10?!1:t.pm_flags&_t.JUMP_HELD?(e.cmd.upmove=0,!1):(Qt=!1,Gt=!1,t.pm_flags|=_t.JUMP_HELD,t.groundEntityNum=f,t.velocity[2]=vt,e.cmd.forwardmove>=0?(rn(e,St.LEGS_JUMP),t.pm_flags&=~_t.BACKWARDS_JUMP):(rn(e,St.LEGS_JUMPB),t.pm_flags|=_t.BACKWARDS_JUMP),!0)}function cn(e){var t=e.ps,n=[t.origin[0],t.origin[1],t.origin[2]-.25],r=e.trace(t.origin,n,e.mins,e.maxs,t.clientNum,e.tracemask);Kt=r;if(r.allSolid&&!hn(e,r))return;if(r.fraction===1){pn(e);return}if(t.velocity[2]>0&&vec3.dot(t.velocity,r.plane.normal)>10){e.cmd.forwardmove>=0?(rn(e,St.LEGS_JUMP),t.pm_flags&=~_t.BACKWARDS_JUMP):(rn(e,St.LEGS_JUMPB),t.pm_flags|=_t.BACKWARDS_JUMP),t.groundEntityNum=f,Qt=!1,Gt=!1;return}if(r.plane.normal[2]<gt){t.groundEntityNum=f,Qt=!0,Gt=!1;return}t.groundEntityNum=r.entityNum,Qt=!0,Gt=!0}function hn(e,t){var n=e.ps,r=[0,0,0],i;for(var s=-1;s<=1;s++)for(var o=-1;o<=1;o++)for(var u=-1;u<=1;u++){vec3.set(n.origin,r),r[0]+=s,r[1]+=o,r[2]+=u,i=e.trace(r,r,e.mins,e.maxs,n.clientNum,e.tracemask);if(!i.allSolid)return i.clone(t),!0}return n.groundEntityNum=f,Qt=!1,Gt=!1,!1}function pn(e){var t=e.ps;if(t.groundEntityNum!==f){var n=vec3.create(t.origin);n[2]-=64;var r=e.trace(t.origin,n,e.mins,e.maxs,t.clientNum,e.tracemask);r.fraction===1&&(e.cmd.forwardmove>=0?(rn(e,St.LEGS_JUMP),t.pm_flags&=~_t.BACKWARDS_JUMP):(rn(e,St.LEGS_JUMPB),t.pm_flags|=_t.BACKWARDS_JUMP))}e.ps.groundEntityNum=f,Qt=!1,Gt=!1}function dn(e,t){var n=e.ps,r=[0,0,0],i=e.frameTime,s=[],o=4,u=[0,0,0];t&&(vec3.set(n.velocity,r),r[2]-=n.gravity*i,n.velocity[2]=(n.velocity[2]+r[2])*.5,Qt&&(n.velocity=un(n.velocity,Kt.plane.normal,bt))),Qt&&s.push(vec3.set(Kt.plane.normal,[0,0,0])),s.push(vec3.normalize(n.velocity,[0,0,0]));for(var a=0;a<o;a++){vec3.add(n.origin,vec3.scale(n.velocity,i,[0,0,0]),u);var f=e.trace(n.origin,u,e.mins,e.maxs,n.clientNum,e.tracemask);if(f.allSolid)return n.velocity[2]=0,!1;f.fraction>0&&vec3.set(f.endPos,n.origin);if(f.fraction===1)break;i-=i*f.fraction;if(s.length>=mt)return n.velocity=[0,0,0],!1;for(var l=0;l<s.length;l++)if(vec3.dot(f.plane.normal,s[l])>.99){vec3.add(n.velocity,f.plane.normal);break}if(l<s.length)continue;s.push(vec3.set(f.plane.normal,[0,0,0]));for(var l=0;l<s.length;++l){var c=vec3.dot(n.velocity,s[l]);if(c>=.1)continue;var h=un(n.velocity,s[l],bt),p=un(r,s[l],bt);for(var d=0;d<s.length;d++){if(d==l)continue;if(vec3.dot(h,s[d])>=.1)continue;h=un(h,s[d],bt),p=un(p,s[d],bt);if(vec3.dot(h,s[l])>=0)continue;var v=vec3.cross(s[l],s[d],[0,0,0]);vec3.normalize(v);var m=vec3.dot(v,n.velocity);vec3.scale(v,m,h),vec3.cross(s[l],s[d],v),vec3.normalize(v),m=vec3.dot(v,r),vec3.scale(v,m,p);for(var g=0;g<s.length;g++){if(g==l||g==d)continue;if(vec3.dot(h,s[g])>=.1)continue;return n.velocity=[0,0,0],!1}}vec3.set(h,n.velocity),vec3.set(p,r);break}}return t&&vec3.set(r,n.velocity),a===0}function vn(e,t){var n=e.ps,r=vec3.create(n.origin),i=vec3.create(n.velocity);if(dn(e,t))return;var s=vec3.create(r);s[2]-=yt;var o=e.trace(r,s,e.mins,e.maxs,n.clientNum,e.tracemask),u=[0,0,1];if(n.velocity[2]>0&&(o.fraction===1||vec3.dot(o.plane.normal,u)<.7))return;vec3.set(r,u),u[2]+=yt,o=e.trace(r,u,e.mins,e.maxs,n.clientNum,e.tracemask);if(o.allSolid)return;var a=o.endPos[2]-r[2];vec3.set(o.endPos,n.origin),vec3.set(i,n.velocity),dn(e,t),vec3.set(n.origin,s),s[2]-=a,o=e.trace(n.origin,s,e.mins,e.maxs,n.clientNum,e.tracemask),o.allSolid||vec3.set(o.endPos,n.origin),o.fraction<1&&(n.velocity=un(n.velocity,o.plane.normal,bt))}function mn(e){var t=e.ps,n=e.cmd;on(e,!0);var r=sn(n,t.speed),i=[0,0,0];for(var s=0;s<3;s++)i[s]=r*Vt[s]*n.forwardmove+r*$t[s]*n.rightmove;i[2]+=n.upmove;var o=vec3.length(i),u=vec3.normalize(i,[0,0,0]);an(e,u,o,Ut),vn(e,!1)}function gn(e){var t=e.ps,n=e.cmd;on(e),xn(e),Vt[2]=0,$t[2]=0,vec3.normalize(Vt),vec3.normalize($t);var r=sn(n,t.speed),i=[0,0,0];for(var s=0;s<2;s++)i[s]=Vt[s]*n.forwardmove+$t[s]*n.rightmove;i[2]=0;var o=vec3.length(i),u=vec3.normalize(i,[0,0,0]);o*=r,an(e,u,o,Rt),Qt&&un(t.velocity,Kt.plane.normal,t.velocity,bt),vn(e,!0)}function yn(e){var t=e.ps,n=e.cmd;if(ln(e)){gn(e);return}on(e),xn(e),Vt[2]=0,$t[2]=0,Vt=un(Vt,Kt.plane.normal,bt),$t=un($t,Kt.plane.normal,bt),vec3.normalize(Vt),vec3.normalize($t);var r=sn(n,t.speed),i=[0,0,0];for(var s=0;s<3;s++)i[s]=Vt[s]*n.forwardmove+$t[s]*n.rightmove;var o=vec3.length(i),u=vec3.normalize(i,[0,0,0]);o*=r;var a=qt;if(Kt.surfaceFlags&G.SLICK||t.pm_flags&_t.TIME_KNOCKBACK)a=Rt;an(e,u,o,a);if(Kt.surfaceFlags&G.SLICK||t.pm_flags&_t.TIME_KNOCKBACK)t.velocity[2]-=t.gravity*e.frameTime;var f=vec3.length(t.velocity);t.velocity=un(t.velocity,Kt.plane.normal,bt),vec3.normalize(t.velocity),vec3.scale(t.velocity,f);if(!t.velocity[0]&&!t.velocity[1])return;vn(e,!1)}function bn(e,t){for(var n=0;n<3;n++){var r=t.angles[n]+e.delta_angles[n]&65535;r>32767&&(r-=65535),n===L&&(r>16e3?(e.delta_angles[n]=16e3-t.angles[n],r=16e3):r<-16e3&&(e.delta_angles[n]=-16e3-t.angles[n],r=-16e3)),e.viewangles[n]=q(r)}}function wn(e){var t=e.ps;t.pm_time&&(Yt>=t.pm_time?(t.pm_flags&=~_t.ALL_TIMES,t.pm_time=0):t.pm_time-=Yt)}function En(e){nn(e,St.TORSO_STAND)}function Sn(e){var t=e.ps;e.xyspeed=Math.sqrt(t.velocity[0]*t.velocity[0]+t.velocity[1]*t.velocity[1]);if(t.groundEntityNum===f){e.waterlevel>1&&tn(e,St.LEGS_SWIM);return}if(!e.cmd.forwardmove&&!e.cmd.rightmove){e.xyspeed<5&&(t.bobCycle=0,t.pm_flags&_t.DUCKED?tn(e,St.LEGS_IDLECR):tn(e,St.LEGS_IDLE));return}var n=!1,r=0;t.pm_flags&_t.DUCKED?(r=.5,t.pm_flags&_t.BACKWARDS_RUN?tn(e,St.LEGS_BACKCR):tn(e,St.LEGS_WALKCR)):e.cmd.buttons&b.WALKING?(r=.3,t.pm_flags&_t.BACKWARDS_RUN?tn(e,St.LEGS_BACKWALK):tn(e,St.LEGS_WALK)):(r=.4,t.pm_flags&_t.BACKWARDS_RUN?tn(e,St.LEGS_BACK):tn(e,St.LEGS_RUN),n=!0)}function xn(e){var t=e.ps;e.cmd.forwardmove||e.cmd.rightmove?e.cmd.rightmove===0&&e.cmd.forwardmove>0?t.movementDir=0:e.cmd.rightmove<0&&e.cmd.forwardmove>0?t.movementDir=1:e.cmd.rightmove<0&&e.cmd.forwardmove===0?t.movementDir=2:e.cmd.rightmove<0&&e.cmd.forwardmove<0?t.movementDir=3:e.cmd.rightmove===0&&e.cmd.forwardmove<0?t.movementDir=4:e.cmd.rightmove>0&&e.cmd.forwardmove<0?t.movementDir=5:e.cmd.rightmove>0&&e.cmd.forwardmove===0?t.movementDir=6:e.cmd.rightmove>0&&e.cmd.forwardmove>0&&(t.movementDir=7):t.movementDir===2?t.movementDir=1:t.movementDir===6&&(t.movementDir=7)}function Tn(e){var t=e.ps,n=e.cmd;t.commandTime=n.serverTime,e.frameTime=Yt*.001,bn(t,n),H(t.viewangles,Vt,$t,Jt);if(Math.abs(n.forwardmove)>64||Math.abs(n.rightmove)>64)n.buttons&=~b.WALKING;e.cmd.upmove<10&&(t.pm_flags&=~_t.JUMP_HELD);if(n.forwardmove<0)t.pm_flags|=_t.BACKWARDS_RUN;else if(e.cmd.forwardmove>0||n.forwardmove===0&&n.rightmove)t.pm_flags&=~_t.BACKWARDS_RUN;fn(e),cn(e),wn(e),Gt?yn(e):gn(e),cn(e),En(e),Sn(e)}function Nn(e){var t=e.ps,n=e.cmd;if(n.serverTime<t.commandTime)return;n.serverTime>t.commandTime+1e3&&(t.commandTime=n.serverTime-1e3),t.pmove_framecount=t.pmove_framecount+1&(1<<S)-1;while(t.commandTime!=n.serverTime)Yt=n.serverTime-t.commandTime,Yt<1?Yt=1:Yt>66&&(Yt=66),Tn(e),e.ps.pm_flags&_t.JUMP_HELD&&(e.cmd.upmove=20)}var t="baseq3",n=64,r={FATAL:0,DROP:1,DISCONNECT:2},i=1,s=2,o=4,u=32,a=1024,f=a-1,l=a-2,c=a-2,h=256,p=256,d={NAD:0,LOOPBACK:1,IP:2},v={CLIENT:0,SERVER:1},m=function(e,t,n){this.type=e,this.ip=t,this.port=n},g=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},y={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},b={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},w=120,E=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};E.prototype.clone=function(e){return typeof e=="undefined"&&(e=new E),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var S=6,x=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=f,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};x.prototype.clone=function(e){return typeof e=="undefined"&&(e=new x),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var T={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},N=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};N.prototype.clone=function(e){return typeof e=="undefined"&&(e=new N),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var C=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},k=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new N,this.apos=new N,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=f,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};k.prototype.clone=function(e){return typeof e=="undefined"&&(e=new k),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var L=0,A=1,O=2,I=function(e){return e*65536/360&65535},q=function(e){return e*(360/65536)},R=0,U=1,z=2,W=3,X=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};X.prototype.clone=function(e){return typeof e=="undefined"&&(e=new X),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],G={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},Y={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},Z=function(){this.fileofs=0,this.filelen=0},et=function(){this.ident=null,this.version=0,this.lumps=new Array(Y.NUM_LUMPS);for(var e=0;e<Y.NUM_LUMPS;e++)this.lumps[e]=new Z},tt=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};tt.size=40;var nt=function(){this.shaderName=null,this.flags=0,this.contents=0};nt.size=72;var rt=function(){this.normal=[0,0,0],this.dist=0};rt.size=16;var it=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};it.size=36;var st=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};st.size=48;var ot=function(){this.planeNum=0,this.shader=0};ot.size=8;var ut=function(){this.side=0,this.numsides=0,this.shader=0};ut.size=12;var at=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};at.size=72;var ft=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};ft.size=44;var lt={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},ct=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};ct.size=104;var dt=800,vt=270,mt=5,gt=.7,yt=18,bt=1.001,wt=26,Et=15,St={BOTH_DEATH1:0,BOTH_DEAD1:1,BOTH_DEATH2:2,BOTH_DEAD2:3,BOTH_DEATH3:4,BOTH_DEAD3:5,TORSO_GESTURE:6,TORSO_ATTACK:7,TORSO_ATTACK2:8,TORSO_DROP:9,TORSO_RAISE:10,TORSO_STAND:11,TORSO_STAND2:12,LEGS_WALKCR:13,LEGS_WALK:14,LEGS_RUN:15,LEGS_BACK:16,LEGS_SWIM:17,LEGS_JUMP:18,LEGS_LAND:19,LEGS_JUMPB:20,LEGS_LANDB:21,LEGS_IDLE:22,LEGS_IDLECR:23,LEGS_TURN:24,TORSO_GETFLAG:25,TORSO_GUARDBASE:26,TORSO_PATROL:27,TORSO_FOLLOWME:28,TORSO_AFFIRMATIVE:29,TORSO_NEGATIVE:30,MAX:31,LEGS_BACKCR:32,LEGS_BACKWALK:33,FLAG_RUN:34,FLAG_STAND:35,FLAG_STAND2RUN:36,MAX_TOTALANIMATIONS:37},xt=function(){this.firstFrame=0,this.numFrames=0,this.loopFrames=0,this.frameLerp=0,this.initialLerp=0,this.reversed=!1,this.flipflop=!1},Tt=128,Nt={BAD:0,WEAPON:1,AMMO:2,ARMOR:3,HEALTH:4,POWERUP:5,HOLDABLE:6,PERSISTANT_POWERUP:7,TEAM:8},Ct=function(e,t,n){this.classname=e,this.modelPaths=t,this.giType=n},kt={GENERAL:0,PLAYER:1,ITEM:2,MISSILE:3,MOVER:4,BEAM:5,PORTAL:6,SPEAKER:7,PUSH_TRIGGER:8,TELEPORT_TRIGGER:9,INVISIBLE:10,GRAPPLE:11,TEAM:12,EVENTS:13},Lt={DEAD:1,TELEPORT_BIT:4,AWARD_EXCELLENT:8,PLAYER_EVENT:16,BOUNCE:16,BOUNCE_HALF:32,AWARD_GAUNTLET:64,NODRAW:128,FIRING:256,KAMIKAZE:512,MOVER_STOP:1024,AWARD_CAP:2048,TALK:4096,CONNECTION:8192,VOTED:16384,AWARD_IMPRESSIVE:32768,AWARD_DEFEND:65536,AWARD_ASSIST:131072,AWARD_DENIED:262144,TEAMVOTED:524288},At={SOLID:1,LAVA:8,SLIME:16,WATER:32,FOG:64,NOTTEAM1:128,NOTTEAM2:256,NOBOTCLIP:512,AREAPORTAL:32768,PLAYERCLIP:65536,MONSTERCLIP:131072,TELEPORTER:262144,JUMPPAD:524288,CLUSTERPORTAL:1048576,DONOTENTER:2097152,BOTCLIP:4194304,MOVER:8388608,ORIGIN:16777216,BODY:33554432,CORPSE:67108864,DETAIL:134217728,STRUCTURAL:268435456,TRANSLUCENT:536870912,TRIGGER:1073741824,NODROP:2147483648},Ot={ALL:-1,SOLID:At.SOLID,PLAYERSOLID:At.SOLID|At.PLAYERCLIP|At.BODY,DEADSOLID:At.SOLID|At.PLAYERCLIP,WATER:At.WATER|At.LAVA|At.SLIME,OPAQUE:At.SOLID|At.SLIME|At.LAVA,SHOT:At.SOLID|At.BODY|At.CORPSE},Mt={NORMAL:0,NOCLIP:1,SPECTATOR:2,DEAD:3,FREEZE:4,INTERMISSION:5},_t={DUCKED:1,JUMP_HELD:2,BACKWARDS_JUMP:8,BACKWARDS_RUN:16,TIME_LAND:32,TIME_KNOCKBACK:64,TIME_WATERJUMP:256,RESPAWNED:512,USE_ITEM_HELD:1024,GRAPPLE_PULL:2048,FOLLOW:4096,SCOREBOARD:8192,INVULEXPAND:16384,ALL_TIMES:352},Dt=function(){this.ps=null,this.cmd=null,this.frameTime=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.xyspeed=0,this.trace=null},jt=100,Ft=.25,It=50,qt=10,Rt=1,Ut=8,zt=6,Wt=3,Xt=10,Vt=[0,0,0],$t=[0,0,0],Jt=[0,0,0],Kt,Qt,Gt,Yt,Cn=[new Ct("item_armor_shard",["models/powerups/armor/shard.md3"],Nt.ARMOR),new Ct("item_armor_combat",["models/powerups/armor/armor_yel.md3"],Nt.ARMOR),new Ct("item_armor_body",["models/powerups/armor/armor_red.md3"],Nt.ARMOR),new Ct("item_health_small",["models/powerups/health/small_cross.md3","models/powerups/health/small_sphere.md3"],Nt.HEALTH),new Ct("item_health",["models/powerups/health/medium_cross.md3","models/powerups/health/medium_sphere.md3"],Nt.HEALTH),new Ct("item_health_large",["models/powerups/health/large_cross.md3","models/powerups/health/large_sphere.md3"],Nt.HEALTH),new Ct("item_health_mega",["models/powerups/health/mega_cross.md3","models/powerups/health/mega_sphere.md3"],Nt.HEALTH),new Ct("weapon_shotgun",["models/weapons2/shotgun/shotgun.md3"],Nt.WEAPON),new Ct("weapon_machinegun",["models/weapons2/machinegun/machinegun.md3"],Nt.WEAPON),new Ct("weapon_grenadelauncher"["models/weapons2/grenadel/grenadel.md3"],Nt.WEAPON),new Ct("weapon_rocketlauncher",["models/weapons2/rocketl/rocketl.md3"],Nt.WEAPON),new Ct("weapon_lightning",["models/weapons2/lightning/lightning.md3"],Nt.WEAPON),new Ct("weapon_railgun",["models/weapons2/railgun/railgun.md3"],Nt.WEAPON),new Ct("weapon_plasmagun",["models/weapons2/plasma/plasma.md3"],Nt.WEAPON),new Ct("item_quad",["models/powerups/instant/quad.md3","models/powerups/instant/quad_ring.md3"],Nt.POWERUP)];return{ItemList:Cn,Pmove:Nn,UpdateViewAngles:bn,PlayerStateToEntityState:Pt,EvaluateTrajectory:Ht,TouchJumpPad:Bt}}),define("game/gm",["underscore","glmatrix","game/bg"],function(_,glmatrix,bg){function LerpAngle(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function AngleSubtract(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function AnglesSubtract(e,t,n){n[0]=AngleSubtract(e[0],t[0]),n[1]=AngleSubtract(e[1],t[1]),n[2]=AngleSubtract(e[2],t[2])}function AngleMod(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function AnglesToVectors(e,t,n,r){var i,s,o,u,a,f,l;i=e[YAW]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[PITCH]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[ROLL]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function AnglesToAxis(e,t){var n=[0,0,0];AnglesToVectors(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function AxisClear(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function AxisMultiply(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function PlaneTypeForNormal(e){return e[0]==1?PLANE_X:e[1]==1?PLANE_Y:e[2]==1?PLANE_Z:PLANE_NON_AXIAL}function GetPlaneSignbits(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function BoxOnPlaneSide(e,t,n){if(n.type<PLANE_NON_AXIAL)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function RadixSort(e,t,n){var r=new Array(n),i=[].concat(_radixSort_0),s=[].concat(_radixSort_0),o=[].concat(_radixSort_0),u=[].concat(_radixSort_0),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function ClampChar(e){return e<-128?-128:e>127?127:e}function atob64(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function log(){var e=Array.prototype.slice.call(arguments);e.splice(0,0,"GM:"),Function.apply.call(console.log,console,e)}function error(e){com.error(Err.DROP,e)}function Init(e,t){log("Initializing"),com=e,sv=t,level=new LevelLocals,g_gravity=com.AddCvar("g_gravity",800),sv.LocateGameData(level.gentities,level.clients),SpawnAllEntitiesFromDefs()}function Shutdown(){}function Frame(e){level.framenum++,level.previousTime=level.time,level.time=e;for(var t=0;t<level.gentities.length;t++){var n=level.gentities[t];if(!n)continue;EntityThink(n)}}function TouchTriggers(e){if(!e.client)return;var t=e.client.ps,n=[40,40,52],r=[0,0,0],i=[0,0,0];vec3.subtract(t.origin,n,r),vec3.add(t.origin,n,i);var s=sv.FindEntitiesInBox(r,i);for(var o=0;o<s.length;o++){var u=level.gentities[s[o]];if(!u.touch)continue;if(!(u.contents&ContentTypes.TRIGGER))continue;u.touch.call(this,u,e)}t.jumppad_frame!=t.pmove_framecount&&(t.jumppad_frame=0,t.jumppad_ent=0)}function ClientConnect(e,t){var n=level.clients[e]=new GameClient,r=level.gentities[e]=new GameEntity;return r.client=n,log("ClientConnect "+e),ClientUserinfoChanged(e),null}function ClientUserinfoChanged(e){var t=level.gentities[e],n=t.client,r=sv.GetUserinfo(e);n.pers.netname=r.name;var i={name:n.pers.netname};sv.SetConfigstring("player"+e,i),log("ClientUserinfoChanged: "+e+" "+JSON.stringify(i))}function ClientBegin(e){var t=level.gentities[e];t.s.number=e,t.client.ps.clientNum=e,ClientSpawn(t)}function ClientThink(e){var t=level.clients[e],n=level.gentities[e];sv.GetUserCommand(e,n.client.pers.cmd);var r=n.client.pers.cmd;r.serverTime>level.time+200&&(r.serverTime=level.time+200),r.serverTime<level.time-1e3&&(r.serverTime=level.time-1e3),t.ps.gravity=g_gravity(),t.ps.speed=320;var i=new PmoveInfo;i.ps=t.ps,i.cmd=r,i.tracemask=ContentMasks.PLAYERSOLID,i.trace=sv.Trace,i.client=!1,bg.Pmove(i),bg.PlayerStateToEntityState(n.client.ps,n.s),vec3.set(t.ps.origin,n.currentOrigin),vec3.set(i.mins,n.mins),vec3.set(i.maxs,n.maxs),sv.LinkEntity(n),TouchTriggers(n),vec3.set(n.client.ps.origin,n.currentOrigin)}function GetClientPlayerstate(e){var t=level.clients[e];return t.ps}function ClientSpawn(e){var t=e.client,n=e.client.ps;e.classname="player",e.contents=ContentTypes.BODY,e.s.groundEntityNum=ENTITYNUM_NONE,vec3.set(playerMins,e.mins),vec3.set(playerMaxs,e.maxs);var r=SelectRandomDeathmatchSpawnPoint(),i=vec3.create(r.s.origin);i[2]+=9,SetOrigin(e,i),vec3.set(i,n.origin),vec3.set(n.velocity,[0,0,0]),sv.GetUserCommand(t.ps.clientNum,e.client.pers.cmd),SetClientViewAngle(e,r.s.angles),n.torsoAnim=Animations.TORSO_STAND,n.legsAnim=Animations.LEGS_IDLE}function ClientDisconnect(e){var t=level.gentities[e];if(!t.client)return;log("ClientDisconnect: "+e),sv.UnlinkEntity(t),t.s.modelindex=0,t.classname="disconnected"}function SetClientViewAngle(e,t){for(var n=0;n<3;n++){var r=AngleToShort(t[n]);e.client.ps.delta_angles[n]=r-e.client.pers.cmd.angles[n]}vec3.set(t,e.s.angles),vec3.set(e.s.angles,e.client.ps.viewangles)}function SelectNearestDeathmatchSpawnPoint(e){var t=999999,n=null,r=FindEntity("classname","info_player_deathmatch");for(var i=0;i<r.length;i++){var s=r[i],o=vec3.length(vec3.subtract(s.origin,e,[0,0,0]));o<t&&(t=o,n=s)}return n}function SelectRandomDeathmatchSpawnPoint(){var e=FindEntity("classname","info_player_deathmatch");return e[Math.floor(Math.random()*e.length)]}function SpawnEntity(){for(var e=MAX_CLIENTS;e<MAX_GENTITIES;e++){if(level.gentities[e])continue;var t=level.gentities[e]=new GameEntity;return t.s.number=e,t}return null}function FreeEntity(e){sv.UnlinkEntity(e),delete level.gentities[e.s.number]}function FindEntity(e,t){var n=[];for(var r=0;r<level.gentities.length;r++){var i=level.gentities[r];if(!i)continue;i[e]===t&&n.push(i)}return n}function SetOrigin(e,t){vec3.set(t,e.s.pos.trBase),e.s.pos.trType=TrajectoryType.STATIONARY,e.s.pos.trTime=0,e.s.pos.trDuration=0,vec3.set([0,0,0],e.s.pos.trDelta),vec3.set(t,e.currentOrigin)}function EntityThink(e){var t=e.nextthink;if(t<=0)return;if(t>level.time)return;e.nextthink=0,e.think||error("NULL ent->think"),e.think.call(this,e)}function EntityPickTarget(e){e||error("EntityPickTarget called with NULL targetname");var t=FindEntity("targetname",e);return t.length||error("EntityPickTarget: target "+e+" not found"),t[Math.floor(Math.random()*t.length)]}function SpawnEntityFromDef(def){var ent=SpawnEntity();for(var defKey in def){if(!def.hasOwnProperty(defKey))continue;var entKeys=keyMap[defKey]||[defKey];for(var i=0;i<entKeys.length;i++){var entKey=entKeys[i],val=eval("ent."+entKey);if(val===undefined)continue;eval("ent."+entKey+" = def[defKey]")}}entityEvents[ent.classname]&&_.extend(ent,entityEvents[ent.classname]);var spawn;for(var i=0;i<bg.ItemList.length;i++){var item=bg.ItemList[i];if(item.classname===ent.classname){SpawnItem(ent,item);return}}if(!ent.spawn){FreeEntity(ent);return}ent.spawn.call(this,ent)}function SpawnAllEntitiesFromDefs(){var e=sv.GetEntityDefs();for(var t=0;t<e.length;t++){var n=e[t];SpawnEntityFromDef(n)}}function SpawnItem(e,t){e.item=t,e.nextthink=level.time+FRAMETIME*2,e.think=FinishSpawningItem}function FinishSpawningItem(e){var t=bg.ItemList.indexOf(e.item);vec3.set([-ITEM_RADIUS,-ITEM_RADIUS,-ITEM_RADIUS],e.mins),vec3.set([ITEM_RADIUS,ITEM_RADIUS,ITEM_RADIUS],e.maxs),e.s.eType=EntityType.ITEM,e.s.modelIndex=t,e.contents=ContentTypes.TRIGGER,SetOrigin(e,e.s.origin),sv.LinkEntity(e)}function TeleportPlayer(e,t,n){var r=n[0]>999999;sv.UnlinkEntity(e),vec3.set(t,e.client.ps.origin),e.client.ps.origin[2]+=1,r||(AnglesToVectors(n,e.client.ps.velocity,null,null),vec3.scale(e.client.ps.velocity,400),e.client.ps.pm_time=160,e.client.ps.pm_flags|=PmoveFlags.TIME_KNOCKBACK,SetClientViewAngle(e,n)),e.client.ps.eFlags^=EntityFlags.TELEPORT_BIT,bg.PlayerStateToEntityState(e.client.ps,e.s),vec3.set(e.client.ps.origin,e.currentOrigin),sv.LinkEntity(e)}function AimAtTarget(e){var t=vec3.add(e.absmin,e.absmax,[0,0,0]);vec3.scale(t,.5);var n=EntityPickTarget(e.target);if(!n){FreeEntity(e);return}var r=n.s.origin[2]-t[2],i=g_gravity(),s=Math.sqrt(r/(.5*i));if(!s){FreeEntity(e);return}vec3.subtract(n.s.origin,t,e.s.origin2),e.s.origin2[2]=0;var o=vec3.length(e.s.origin2);vec3.normalize(e.s.origin2);var u=o/s;vec3.scale(e.s.origin2,u),e.s.origin2[2]=s*i}var Q3W_BASE_FOLDER="baseq3",MAX_QPATH=64,Err={FATAL:0,DROP:1,DISCONNECT:2},SNAPFLAG_RATE_DELAYED=1,SNAPFLAG_NOT_ACTIVE=2,SNAPFLAG_SERVERCOUNT=4,MAX_CLIENTS=32,MAX_GENTITIES=1024,ENTITYNUM_NONE=MAX_GENTITIES-1,ENTITYNUM_WORLD=MAX_GENTITIES-2,ENTITYNUM_MAX_NORMAL=MAX_GENTITIES-2,MAX_MODELS=256,MAX_SOUNDS=256,NetAdrType={NAD:0,LOOPBACK:1,IP:2},NetSrc={CLIENT:0,SERVER:1},NetAdr=function(e,t,n){this.type=e,this.ip=t,this.port=n},Cvar=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},CvarFlags={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},Buttons={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},MOVE_RUN=120,UserCmd=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};UserCmd.prototype.clone=function(e){return typeof e=="undefined"&&(e=new UserCmd),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var PS_PMOVEFRAMECOUNTBITS=6,PlayerState=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=ENTITYNUM_NONE,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};PlayerState.prototype.clone=function(e){return typeof e=="undefined"&&(e=new PlayerState),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var TrajectoryType={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},Trajectory=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};Trajectory.prototype.clone=function(e){return typeof e=="undefined"&&(e=new Trajectory),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var Orientation=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},EntityState=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new Trajectory,this.apos=new Trajectory,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=ENTITYNUM_NONE,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};EntityState.prototype.clone=function(e){return typeof e=="undefined"&&(e=new EntityState),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var PITCH=0,YAW=1,ROLL=2,AngleToShort=function(e){return e*65536/360&65535},ShortToAngle=function(e){return e*(360/65536)},PLANE_X=0,PLANE_Y=1,PLANE_Z=2,PLANE_NON_AXIAL=3,Plane=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};Plane.prototype.clone=function(e){return typeof e=="undefined"&&(e=new Plane),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var _radixSort_0=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],SurfaceFlags={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},Lumps={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},lumps_t=function(){this.fileofs=0,this.filelen=0},dheader_t=function(){this.ident=null,this.version=0,this.lumps=new Array(Lumps.NUM_LUMPS);for(var e=0;e<Lumps.NUM_LUMPS;e++)this.lumps[e]=new lumps_t},dmodel_t=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};dmodel_t.size=40;var dshader_t=function(){this.shaderName=null,this.flags=0,this.contents=0};dshader_t.size=72;var dplane_t=function(){this.normal=[0,0,0],this.dist=0};dplane_t.size=16;var dnode_t=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};dnode_t.size=36;var dleaf_t=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};dleaf_t.size=48;var dbrushside_t=function(){this.planeNum=0,this.shader=0};dbrushside_t.size=8;var dbrush_t=function(){this.side=0,this.numsides=0,this.shader=0};dbrush_t.size=12;var dfog_t=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};dfog_t.size=72;var drawVert_t=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};drawVert_t.size=44;var MapSurfaceType={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},dsurface_t=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};dsurface_t.size=104;var DEFAULT_GRAVITY=800,JUMP_VELOCITY=270,MAX_CLIP_PLANES=5,MIN_WALK_NORMAL=.7,STEPSIZE=18,OVERCLIP=1.001,DEFAULT_VIEWHEIGHT=26,ITEM_RADIUS=15,Animations={BOTH_DEATH1:0,BOTH_DEAD1:1,BOTH_DEATH2:2,BOTH_DEAD2:3,BOTH_DEATH3:4,BOTH_DEAD3:5,TORSO_GESTURE:6,TORSO_ATTACK:7,TORSO_ATTACK2:8,TORSO_DROP:9,TORSO_RAISE:10,TORSO_STAND:11,TORSO_STAND2:12,LEGS_WALKCR:13,LEGS_WALK:14,LEGS_RUN:15,LEGS_BACK:16,LEGS_SWIM:17,LEGS_JUMP:18,LEGS_LAND:19,LEGS_JUMPB:20,LEGS_LANDB:21,LEGS_IDLE:22,LEGS_IDLECR:23,LEGS_TURN:24,TORSO_GETFLAG:25,TORSO_GUARDBASE:26,TORSO_PATROL:27,TORSO_FOLLOWME:28,TORSO_AFFIRMATIVE:29,TORSO_NEGATIVE:30,MAX:31,LEGS_BACKCR:32,LEGS_BACKWALK:33,FLAG_RUN:34,FLAG_STAND:35,FLAG_STAND2RUN:36,MAX_TOTALANIMATIONS:37},Animation=function(){this.firstFrame=0,this.numFrames=0,this.loopFrames=0,this.frameLerp=0,this.initialLerp=0,this.reversed=!1,this.flipflop=!1},ANIM_TOGGLEBIT=128,ItemType={BAD:0,WEAPON:1,AMMO:2,ARMOR:3,HEALTH:4,POWERUP:5,HOLDABLE:6,PERSISTANT_POWERUP:7,TEAM:8},GameItemDesc=function(e,t,n){this.classname=e,this.modelPaths=t,this.giType=n},EntityType={GENERAL:0,PLAYER:1,ITEM:2,MISSILE:3,MOVER:4,BEAM:5,PORTAL:6,SPEAKER:7,PUSH_TRIGGER:8,TELEPORT_TRIGGER:9,INVISIBLE:10,GRAPPLE:11,TEAM:12,EVENTS:13},EntityFlags={DEAD:1,TELEPORT_BIT:4,AWARD_EXCELLENT:8,PLAYER_EVENT:16,BOUNCE:16,BOUNCE_HALF:32,AWARD_GAUNTLET:64,NODRAW:128,FIRING:256,KAMIKAZE:512,MOVER_STOP:1024,AWARD_CAP:2048,TALK:4096,CONNECTION:8192,VOTED:16384,AWARD_IMPRESSIVE:32768,AWARD_DEFEND:65536,AWARD_ASSIST:131072,AWARD_DENIED:262144,TEAMVOTED:524288},ContentTypes={SOLID:1,LAVA:8,SLIME:16,WATER:32,FOG:64,NOTTEAM1:128,NOTTEAM2:256,NOBOTCLIP:512,AREAPORTAL:32768,PLAYERCLIP:65536,MONSTERCLIP:131072,TELEPORTER:262144,JUMPPAD:524288,CLUSTERPORTAL:1048576,DONOTENTER:2097152,BOTCLIP:4194304,MOVER:8388608,ORIGIN:16777216,BODY:33554432,CORPSE:67108864,DETAIL:134217728,STRUCTURAL:268435456,TRANSLUCENT:536870912,TRIGGER:1073741824,NODROP:2147483648},ContentMasks={ALL:-1,SOLID:ContentTypes.SOLID,PLAYERSOLID:ContentTypes.SOLID|ContentTypes.PLAYERCLIP|ContentTypes.BODY,DEADSOLID:ContentTypes.SOLID|ContentTypes.PLAYERCLIP,WATER:ContentTypes.WATER|ContentTypes.LAVA|ContentTypes.SLIME,OPAQUE:ContentTypes.SOLID|ContentTypes.SLIME|ContentTypes.LAVA,SHOT:ContentTypes.SOLID|ContentTypes.BODY|ContentTypes.CORPSE},PmoveType={NORMAL:0,NOCLIP:1,SPECTATOR:2,DEAD:3,FREEZE:4,INTERMISSION:5},PmoveFlags={DUCKED:1,JUMP_HELD:2,BACKWARDS_JUMP:8,BACKWARDS_RUN:16,TIME_LAND:32,TIME_KNOCKBACK:64,TIME_WATERJUMP:256,RESPAWNED:512,USE_ITEM_HELD:1024,GRAPPLE_PULL:2048,FOLLOW:4096,SCOREBOARD:8192,INVULEXPAND:16384,ALL_TIMES:352},PmoveInfo=function(){this.ps=null,this.cmd=null,this.frameTime=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.xyspeed=0,this.trace=null},FRAMETIME=100,LevelLocals=function(){this.framenum=0,this.previousTime=0,this.time=0,this.clients=new Array(MAX_CLIENTS),this.gentities=new Array(MAX_GENTITIES)},ServerFlags={NOCLIENT:1,BOT:2,BROADCAST:8,PORTAL:32,USE_CURRENT_ORIGIN:64,SINGLECLIENT:128,NOTSINGLECLIENT:256},GameEntity=function(){this.s=new EntityState,this.linked=!1,this.svFlags=0,this.singleClient=0,this.bmodel=!1,this.mins=[0,0,0],this.maxs=[0,0,0],this.contents=0,this.absmin=[0,0,0],this.absmax=[0,0,0],this.currentOrigin=[0,0,0],this.currentAngles=[0,0,0],this.client=null,this.classname="noclass",this.spawnflags=0,this.model=null,this.model2=null,this.target=null,this.targetname=null,this.nextthink=0},GameClient=function(){this.ps=new PlayerState,this.pers=new GameClientPersistant},GameClientPersistant=function(){this.cmd=new UserCmd,this.netname=null},com,sv,level,g_gravity,playerMins=[-15,-15,-24],playerMaxs=[15,15,32],entityEvents={},keyMap={origin:["s.origin","currentOrigin"],angles:["s.angles"]};return entityEvents.info_notnull={spawn:function(e){SetOrigin(e,e.s.origin)}},entityEvents.info_player_deathmatch={spawn:function(e){}},entityEvents.misc_teleporter_dest={spawn:function(e){SetOrigin(e,e.s.origin)}},entityEvents.target_position={spawn:function(e){SetOrigin(e,e.s.origin)}},entityEvents.target_push={spawn:function(e){e.speed||(e.speed=1e3)}},entityEvents.trigger_push={spawn:function(e){sv.SetBrushModel(e,e.model),e.s.eType=EntityType.PUSH_TRIGGER,e.contents=ContentTypes.TRIGGER,e.nextthink=level.time+FRAMETIME,sv.LinkEntity(e)},think:function(e){AimAtTarget(e)},touch:function(e,t){if(!t.client)return;bg.TouchJumpPad(t.client.ps,e.s)}},entityEvents.trigger_teleport={spawn:function(e){sv.SetBrushModel(e,e.model),e.s.eType=EntityType.TELEPORT_TRIGGER,e.contents=ContentTypes.TRIGGER,sv.LinkEntity(e)},touch:function(e,t){if(!t.client)return;if(t.client.ps.pm_type===PmoveType.DEAD)return;var n=EntityPickTarget(e.target);if(!n){log("Couldn't find teleporter destination"),FreeEntity(e);return}TeleportPlayer(t,n.s.origin,n.s.angles)}},{Init:Init,Shutdown:Shutdown,Frame:Frame,ClientConnect:ClientConnect,ClientBegin:ClientBegin,ClientThink:ClientThink,ClientDisconnect:ClientDisconnect,GetClientPlayerstate:GetClientPlayerstate}}),define("stub",[],function(){return null}),define("client/cl",function(){}),define("clipmap/cm",["underscore","glmatrix","ByteBuffer"],function(e,t,n){function D(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function P(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function H(e,t,n){n[0]=P(e[0],t[0]),n[1]=P(e[1],t[1]),n[2]=P(e[2],t[2])}function B(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function j(e,t,n,r){var i,s,o,u,a,f,l;i=e[M]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[O]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[_]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function F(e,t){var n=[0,0,0];j(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function I(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function q(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function J(e){return e[0]==1?z:e[1]==1?W:e[2]==1?X:V}function K(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function Q(e,t,n){if(n.type<V)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function Y(e,t,n){var r=new Array(n),i=[].concat(G),s=[].concat(G),o=[].concat(G),u=[].concat(G),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function dt(e){return e<-128?-128:e>127?127:e}function vt(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function mt(e){function b(){var e=Array.prototype.slice.call(arguments);e.splice(0,0,"CM:"),Function.apply.call(console.log,console,e)}function E(t,r){b("Initializing"),b("Loading map for "+t),w=new a,e.ReadFile("maps/"+t+".bsp","binary",function(e,t){if(e)throw e;var i=new n(t,n.LITTLE_ENDIAN),s=new nt;s.ident=i.readASCIIString(4),s.version=i.readInt();for(var o=0;o<et.NUM_LUMPS;o++)s.lumps[o].fileofs=i.readInt(),s.lumps[o].filelen=i.readInt();if(s.ident!=="IBSP"&&s.version!==46)return;S(t,s.lumps[et.SHADERS]),x(t,s.lumps[et.LEAFS]),T(t,s.lumps[et.LEAFBRUSHES]),N(t,s.lumps[et.PLANES]),C(t,s.lumps[et.BRUSHSIDES]),k(t,s.lumps[et.BRUSHES]),L(t,s.lumps[et.MODELS]),A(t,s.lumps[et.NODES]),O(t,s.lumps[et.ENTITIES]),r&&r()})}function S(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var s=w.shaders=new Array(t.filelen/it.size);for(var o=0;o<s.length;o++){var u=s[o]=new it;u.shaderName=r.readASCIIString(i),u.flags=r.readInt(),u.contents=r.readInt()}}function x(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var i=w.leafs=new Array(t.filelen/ut.size);for(var s=0;s<i.length;s++){var o=i[s]=new c;o.cluster=r.readInt(),o.area=r.readInt(),r.index+=24,o.firstLeafSurface=r.readInt(),o.numLeafSurfaces=r.readInt(),o.firstLeafBrush=r.readInt(),o.numLeafBrushes=r.readInt()}}function T(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var i=w.leafBrushes=new Array(t.filelen/4);for(var s=0;s<i.length;s++)i[s]=r.readInt()}function N(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var i=w.planes=new Array(t.filelen/st.size);for(var s=0;s<i.length;s++){var o=i[s]=new $;o.normal=[r.readFloat(),r.readFloat(),r.readFloat()],o.dist=r.readFloat(),o.signbits=K(o),o.type=J(o.normal)}}function C(e,t){var r=w.planes,i=new n(e,n.LITTLE_ENDIAN);i.index=t.fileofs;var s=w.brushSides=new Array(t.filelen/at.size);for(var o=0;o<s.length;o++){var u=s[o]=new h,a=i.readInt(),f=i.readInt();u.plane=r[a],u.shaderNum=f,u.surfaceFlags=w.shaders[f].surfaceFlags}}function k(e,t){var r=w.shaders,i=w.brushSides,s=new n(e,n.LITTLE_ENDIAN);s.index=t.fileofs;var o=w.brushes=new Array(t.filelen/ft.size);for(var u=0;u<o.length;u++){var a=o[u]=new p;a.side=s.readInt(),a.numsides=s.readInt(),a.shaderNum=s.readInt(),a.sides=i.slice(a.side,a.side+a.numsides),a.bounds=[[-a.sides[0].plane.dist,-a.sides[2].plane.dist,-a.sides[4].plane.dist],[a.sides[1].plane.dist,a.sides[3].plane.dist,a.sides[5].plane.dist]],a.contents=r[a.shaderNum].contents}}function L(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var i=w.models=new Array(t.filelen/rt.size);for(var s=0;s<i.length;s++){var o=i[s]=new l;o.mins=[r.readFloat()-1,r.readFloat()-1,r.readFloat()-1],o.maxs=[r.readFloat()+1,r.readFloat()+1,r.readFloat()+1];var u=r.readInt(),a=r.readInt(),f=r.readInt(),c=r.readInt();if(s===0)continue}}function A(e,t){var r=w.planes,i=new n(e,n.LITTLE_ENDIAN);i.index=t.fileofs;var s=w.nodes=new Array(t.filelen/ot.size);for(var o=0;o<s.length;o++){var u=s[o]=new f;u.planeNum=i.readInt(),u.childrenNum=[i.readInt(),i.readInt()],i.index+=24}}function O(e,t){var r=new n(e,n.LITTLE_ENDIAN);r.index=t.fileofs;var i=r.readASCIIString(t.filelen),s=w.entities=[];i.replace(/\{([^}]*)\}/mg,function(e,t){var n={classname:"unknown"};t.replace(/"(.+)" "(.+)"$/mg,function(e,t,r){switch(t){case"origin":r.replace(/(.+) (.+) (.+)/,function(e,r,i,s){n[t]=[parseFloat(r),parseFloat(i),parseFloat(s)]});break;case"angles":r.replace(/(.+) (.+) (.+)/,function(e,r,i,s){n[t]=[parseFloat(r),parseFloat(i),parseFloat(s)]});break;case"angle":n.angles=[0,parseFloat(r),0];break;default:n[t]=r}}),s.push(n)})}function M(t){t<0&&e.error(s.DROP,"ClipHandleToModel: bad handle "+t);if(t<w.models.length)return w.models[t];e.error(s.DROP,"ClipHandleToModel: bad handle "+w.models.length+" < "+t)}function _(t){return(t<0||t>=w.models.length)&&e.error(s.DROP,"GetInlineModel: bad number"),t}function D(e,t,n){var r=M(e);vec3.set(r.mins,t),vec3.set(r.maxs,n)}function P(e,t,n,r){for(;;){if(r<0){if(e.count>=v)return;e.list[e.count++]=-1-r;return}var i=w.nodes[r],s=Q(t,n,w.planes[i.planeNum]);s===1?r=i.childrenNum[0]:s===2?r=i.childrenNum[1]:(P(e,t,n,i.childrenNum[0]),r=i.childrenNum[1])}}function H(e,t,n,r){return t[0]<n[0]-u||t[1]<n[1]-u||t[2]<n[2]-u||e[0]>r[0]+u||e[1]>r[1]+u||e[2]>r[2]+u?!1:!0}function B(e,t){var n=vec3.create(e);e[0]=vec3.dot(t[0],n),e[1]=vec3.dot(t[1],n),e[2]=vec3.dot(t[2],n)}function F(e,t){for(var n=0;n<3;n++)for(var r=0;r<3;r++)t[n][r]=e[r][n]}function I(e,t){j(e,t[0],t[1],t[2]),vec3.negate(t[1])}function q(e,t){if(!t.numsides)return;if(e.bounds[0][0]>t.bounds[1][0]||e.bounds[0][1]>t.bounds[1][1]||e.bounds[0][2]>t.bounds[1][2]||e.bounds[1][0]<t.bounds[0][0]||e.bounds[1][1]<t.bounds[0][1]||e.bounds[1][2]<t.bounds[0][2])return;if(e.sphere.use)for(var n=6;n<t.numsides;n++){var r=t.sides[n],i=r.plane,s=i.dist+e.sphere.radius,o=[0,0,0],u=vec3.dot(i.normal,e.sphere.offset);u>0?vec3.subtract(e.start,e.sphere.offset,o):vec3.add(e.start,e.sphere.offset,o);var a=vec3.dot(o,i.normal)-s;if(a>0)return}else for(var n=6;n<t.numsides;n++){var r=t.sides[n],i=r.plane,s=i.dist-vec3.dot(e.offsets[i.signbits],i.normal),a=vec3.dot(e.start,i.normal)-s;if(a>0)return}e.trace.startSolid=e.trace.allSolid=!0,e.trace.fraction=0,e.trace.contents=t.contents}function R(e,t){var n=w.brushes,r=w.leafBrushes;for(var i=0;i<t.numLeafBrushes;i++){var s=r[t.firstLeafBrush+i],o=n[s];if(o.checkcount===w.checkcount)continue;o.checkcount=w.checkcount;if(!(o.contents&e.contents))continue;q(e,o);if(e.trace.allSolid)return}}function z(e){var t=w.leafs,n=vec3.add(e.start,e.size[0],[0,0,0]),r=vec3.add(e.start,e.size[1],[0,0,0]);vec3.add(n,[-1,-1,-1]),vec3.add(r,[1,1,1]),w.checkcount++,U.count=0,P(U,n,r,0),w.checkcount++;for(var i=0;i<U.count;i++){R(e,t[U.list[i]]);if(e.trace.allSolid)break}}function W(e,t,n,r,i,s){var o=w.brushes,a=w.leafs,f=w.leafBrushes,l=w.nodes,c=w.planes,h=w.shaders;if(e.trace.fraction<=n)return;if(t<0){X(e,a[-(t+1)]);return}var p=l[t],d=c[p.planeNum],v,m,g;d.type<3?(v=i[d.type]-d.dist,m=s[d.type]-d.dist,g=e.extents[d.type]):(v=vec3.dot(d.normal,i)-d.dist,m=vec3.dot(d.normal,s)-d.dist,e.isPoint?g=0:g=2048);if(v>=g+1&&m>=g+1){W(e,p.childrenNum[0],n,r,i,s);return}if(v<-g-1&&m<-g-1){W(e,p.childrenNum[1],n,r,i,s);return}var y,b,E,S;v<m?(y=1/(v-m),b=1,S=(v+g+u)*y,E=(v-g+u)*y):v>m?(y=1/(v-m),b=0,S=(v-g-u)*y,E=(v+g+u)*y):(b=0,E=1,S=0);var x=[0,0,0],T;E<0?E=0:E>1&&(E=1),T=n+(r-n)*E,x[0]=i[0]+E*(s[0]-i[0]),x[1]=i[1]+E*(s[1]-i[1]),x[2]=i[2]+E*(s[2]-i[2]),W(e,p.childrenNum[b],n,T,i,x),S<0&&(S=0),S>1&&(S=1),T=n+(r-n)*S,x[0]=i[0]+S*(s[0]-i[0]),x[1]=i[1]+S*(s[1]-i[1]),x[2]=i[2]+S*(s[2]-i[2]),W(e,p.childrenNum[b^1],T,r,x,s)}function X(e,t){var n=w.brushes,r=w.leafBrushes,i=w.shaders;for(var s=0;s<t.numLeafBrushes;s++){var o=r[t.firstLeafBrush+s],u=n[o];if(u.checkcount===w.checkcount)continue;u.checkcount=w.checkcount;if(!(u.contents&e.contents))continue;if(!H(e.bounds[0],e.bounds[1],u.bounds[0],u.bounds[1]))continue;V(e,u);if(!e.trace.fraction)return}}function V(e,t){var n=w.brushSides,r=e.trace,i,s,o=!1,a=!1,f=-1,l=1;if(!t.numsides)return;if(e.sphere.use)for(var c=0;c<t.numsides;c++){var h=t.sides[c],p=h.plane,d=p.dist+e.sphere.radius,v=[0,0,0],m=[0,0,0],g=vec3.dot(p.normal,e.sphere.offset);g>0?(vec3.subtract(e.start,e.sphere.offset,v),vec3.subtract(e.end,e.sphere.offset,m)):(vec3.add(e.start,e.sphere.offset,v),vec3.add(e.end,e.sphere.offset,m));var y=vec3.dot(v,p.normal)-d,b=vec3.dot(m,p.normal)-d;b>0&&(o=!0),y>0&&(a=!0);if(y>0&&(b>=u||b>=y))return;if(y<=0&&b<=0)continue;if(y>b){var E=(y-u)/(y-b);E<0&&(E=0),E>f&&(f=E,s=p,i=h)}else{var E=(y+u)/(y-b);E>1&&(E=1),E<l&&(l=E)}}else for(var c=0;c<t.numsides;c++){var h=t.sides[c],p=h.plane,d=p.dist-vec3.dot(e.offsets[p.signbits],p.normal),y=vec3.dot(e.start,p.normal)-d,b=vec3.dot(e.end,p.normal)-d;b>0&&(o=!0),y>0&&(a=!0);if(y>0&&(b>=u||b>=y))return;if(y<=0&&b<=0)continue;if(y>b){var E=(y-u)/(y-b);E<0&&(E=0),E>f&&(f=E,s=p,i=h)}else{var E=(y+u)/(y-b);E>1&&(E=1),E<l&&(l=E)}}if(!a){e.trace.startSolid=!0,o||(e.trace.allSolid=!0,e.trace.fraction=0,e.trace.contents=t.contents);return}f<l&&f>-1&&f<e.trace.fraction&&(f<0&&(f=0),e.trace.fraction=f,e.trace.plane=s,e.trace.contents=t.contents)}function G(t,n,r,i,o,u,a,f,l){var c=new y,h=c.trace;w.checkcount||(w.checkcount=0),w.checkcount++,c.contents=a;var p=[0,0,0];for(var d=0;d<3;d++)p[d]=(r[d]+i[d])*.5,c.size[0][d]=r[d]-p[d],c.size[1][d]=i[d]-p[d],c.start[d]=t[d]+p[d],c.end[d]=n[d]+p[d];l?l.clone(c.sphere):(c.sphere.use=f,c.sphere.radius=c.size[1][0]>c.size[1][2]?c.size[1][2]:c.size[1][0],c.sphere.halfheight=c.size[1][2],vec3.set([0,0,c.size[1][2]-c.sphere.radius],c.sphere.offset)),c.maxOffset=c.size[1][0]+c.size[1][1]+c.size[1][2],c.offsets[0][0]=c.size[0][0],c.offsets[0][1]=c.size[0][1],c.offsets[0][2]=c.size[0][2],c.offsets[1][0]=c.size[1][0],c.offsets[1][1]=c.size[0][1],c.offsets[1][2]=c.size[0][2],c.offsets[2][0]=c.size[0][0],c.offsets[2][1]=c.size[1][1],c.offsets[2][2]=c.size[0][2],c.offsets[3][0]=c.size[1][0],c.offsets[3][1]=c.size[1][1],c.offsets[3][2]=c.size[0][2],c.offsets[4][0]=c.size[0][0],c.offsets[4][1]=c.size[0][1],c.offsets[4][2]=c.size[1][2],c.offsets[5][0]=c.size[1][0],c.offsets[5][1]=c.size[0][1],c.offsets[5][2]=c.size[1][2],c.offsets[6][0]=c.size[0][0],c.offsets[6][1]=c.size[1][1],c.offsets[6][2]=c.size[1][2],c.offsets[7][0]=c.size[1][0],c.offsets[7][1]=c.size[1][1],c.offsets[7][2]=c.size[1][2];if(c.sphere.use)for(var d=0;d<3;d++)c.start[d]<c.end[d]?(c.bounds[0][d]=c.start[d]-Math.abs(c.sphere.offset[d])-c.sphere.radius,c.bounds[1][d]=c.end[d]+Math.abs(c.sphere.offset[d])+c.sphere.radius):(c.bounds[0][d]=c.end[d]-Math.abs(c.sphere.offset[d])-c.sphere.radius,c.bounds[1][d]=c.start[d]+Math.abs(c.sphere.offset[d])+c.sphere.radius);else for(var d=0;d<3;d++)c.start[d]<c.end[d]?(c.bounds[0][d]=c.start[d]+c.size[0][d],c.bounds[1][d]=c.end[d]+c.size[1][d]):(c.bounds[0][d]=c.end[d]+c.size[0][d],c.bounds[1][d]=c.start[d]+c.size[1][d]);t[0]==n[0]&&t[1]==n[1]&&t[2]==n[2]?z(c):(c.size[0][0]===0&&c.size[0][1]===0&&c.size[0][2]===0?(c.isPoint=!0,c.extents=[0,0,0]):(c.isPoint=!1,c.extents[0]=c.size[1][0],c.extents[1]=c.size[1][1],c.extents[2]=c.size[1][2]),W(c,0,0,1,c.start,c.end));for(var d=0;d<3;d++)c.trace.endPos[d]=t[d]+c.trace.fraction*(n[d]-t[d]);return!c.trace.allSolid&&c.trace.fraction!==1&&vec3.squaredLength(c.trace.plane.normal)<=.9999&&e.error(s.DROP,"Invalid trace result"),h}function Y(e,t,n,r,i,s,o){return G(e,t,n,r,i,[0,0,0],s,o,null)}function Z(e,t,n,i,s,o,u,a,f){typeof n=="undefined"&&(n=[0,0,0]),typeof i=="undefined"&&(i=[0,0,0]);var l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[[0,0,0],[0,0,0]],d=[[0,0,0],[0,0,0],[0,0,0]],v=[[0,0,0],[0,0,0],[0,0,0]];for(var m=0;m<3;m++)h[m]=(n[m]+i[m])*.5,p[0][m]=n[m]-h[m],p[1][m]=i[m]-h[m],l[m]=e[m]+h[m],c[m]=t[m]+h[m];vec3.subtract(l,u),vec3.subtract(c,u);var y=!1;s!==r&&(a[0]||a[1]||a[2])&&(y=!0);var b=p[1][0],w=p[1][2],E=new g;E.use=f,E.radius=b>w?w:b,E.halfheight=w;var S=w-E.radius;y?(I(a,d),B(l,d),B(c,d),E.offset[0]=d[0][2]*S,E.offset[1]=-d[1][2]*S,E.offset[2]=d[2][2]*S):vec3.set([0,0,S],E.offset);var x=G(l,c,p[0],p[1],s,u,o,f,E);return y&&x.fraction!==1&&(F(d,v),B(x.plane.normal,v)),x.endPos[0]=e[0]+x.fraction*(t[0]-e[0]),x.endPos[1]=e[1]+x.fraction*(t[1]-e[1]),x.endPos[2]=e[2]+x.fraction*(t[2]-e[2]),x}var t=256,r=255,o=254,u=.125,a=function(){this.shaders=null,this.brushes=null,this.models=null,this.leafs=null,this.leafBrushes=null,this.nodes=null,this.planes=null,this.shaders=null,this.entities=null},f=function(){this.planeNum=0,this.childrenNum=[0,0]},l=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.leaf=null},c=function(){this.cluster=0,this.area=0,this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0},h=function(){this.plane=null,this.surfaceFlags=0,this.shaderNum=0},p=function(){this.shaderNum=0,this.contents=0,this.bounds=[[0,0,0],[0,0,0]],this.numsides=0,this.sides=null,this.checkcount=0},d=function(){this.allSolid=!1,this.startSolid=!1,this.fraction=1,this.endPos=[0,0,0],this.plane=null};d.prototype.clone=function(e){return typeof e=="undefined"&&(e=new d),e.allSolid=this.allSolid,e.startSolid=this.startSolid,e.fraction=this.fraction,vec3.set(this.endPos,e.endPos),e.plane=this.plane,e};var v=1024,m=function(){this.list=new Uint32Array(v),this.count=0},g=function(){this.use=!1,this.radius=0,this.halfheight=0,this.offset=[0,0,0]};g.prototype.clone=function(e){typeof e=="undefined"&&(e=new g),e.use=this.use,e.radius=this.radius,e.halfheight=this.halfheight,vec3.set(this.offset,e.offset)};var y=function(){this.trace=new d,this.start=[0,0,0],this.end=[0,0,0],this.size=[[0,0,0],[0,0,0]],this.offsets=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.maxOffset=0,this.extents=[0,0,0],this.bounds=[[0,0,0],[0,0,0]],this.contents=0,this.isPoint=!1,this.sphere=new g},w,U=new m;return{LoadMap:E,EntityDefs:function(){return w.entities},InlineModel:_,ModelBounds:D,BoxTrace:Y,TransformedBoxTrace:Z}}var r="baseq3",i=64,s={FATAL:0,DROP:1,DISCONNECT:2},o=1,u=2,a=4,f=32,l=1024,c=l-1,h=l-2,p=l-2,d=256,v=256,m={NAD:0,LOOPBACK:1,IP:2},g={CLIENT:0,SERVER:1},y=function(e,t,n){this.type=e,this.ip=t,this.port=n},b=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},w={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},E={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},S=120,x=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};x.prototype.clone=function(e){return typeof e=="undefined"&&(e=new x),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var T=6,N=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=c,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};N.prototype.clone=function(e){return typeof e=="undefined"&&(e=new N),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var C={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},k=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};k.prototype.clone=function(e){return typeof e=="undefined"&&(e=new k),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var L=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},A=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new k,this.apos=new k,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=c,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};A.prototype.clone=function(e){return typeof e=="undefined"&&(e=new A),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var O=0,M=1,_=2,R=function(e){return e*65536/360&65535},U=function(e){return e*(360/65536)},z=0,W=1,X=2,V=3,$=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};$.prototype.clone=function(e){return typeof e=="undefined"&&(e=new $),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Z={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},et={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},tt=function(){this.fileofs=0,this.filelen=0},nt=function(){this.ident=null,this.version=0,this.lumps=new Array(et.NUM_LUMPS);for(var e=0;e<et.NUM_LUMPS;e++)this.lumps[e]=new tt},rt=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};rt.size=40;var it=function(){this.shaderName=null,this.flags=0,this.contents=0};it.size=72;var st=function(){this.normal=[0,0,0],this.dist=0};st.size=16;var ot=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};ot.size=36;var ut=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};ut.size=48;var at=function(){this.planeNum=0,this.shader=0};at.size=8;var ft=function(){this.side=0,this.numsides=0,this.shader=0};ft.size=12;var lt=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};lt.size=72;var ct=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};ct.size=44;var ht={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},pt=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};return pt.size=104,{CreateInstance:function(e){return new mt(e)}}}),define("server/sv",["underscore","ByteBuffer","game/gm","client/cl","clipmap/cm"],function(e,t,n,r,i){function H(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function B(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function j(e,t,n){n[0]=B(e[0],t[0]),n[1]=B(e[1],t[1]),n[2]=B(e[2],t[2])}function F(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function I(e,t,n,r){var i,s,o,u,a,f,l;i=e[D]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[_]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[P]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function q(e,t){var n=[0,0,0];I(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function R(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function U(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function Q(e){return e[0]==1?X:e[1]==1?V:e[2]==1?$:J}function G(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function Y(e,t,n){if(n.type<J)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function et(e,t,n){var r=new Array(n),i=[].concat(Z),s=[].concat(Z),o=[].concat(Z),u=[].concat(Z),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function mt(e){return e<-128?-128:e>127?127:e}function gt(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function Yt(){var e=Array.prototype.slice.call(arguments);e.splice(0,0,"SV:"),Function.apply.call(console.log,console,e)}function Zt(e,t,n){Yt("Initializing"),Rt=e,Ut=t,zt=n,Wt=new Bt,Xt=new Pt,Vt=i.CreateInstance(Rt),$t=Ut.AddCvar("sv_serverid",0,S.SYSTEMINFO),Jt=Ut.AddCvar("sv_mapname","nomap",S.SERVERINFO),Kt=Ut.AddCvar("sv_fps",20),Qt=Ut.AddCvar("sv_timeout",200),Gt=Ut.AddCvar("sv_zombietime",2),Cn(),setTimeout(function(){kn("q3tourney2")},50)}function en(){var e=Kt(),t=1e3/e;return t<1&&(t=1),t}function tn(e,t){Xt.frameTime=e;if(!Xt.initialized)return;var r=en();Wt.timeResidual+=t;var i=0;while(Wt.timeResidual>=r)Wt.timeResidual-=r,Xt.time+=r,Wt.time+=r,n.Frame(Wt.time),i++;nn(),i>0&&Fn()}function nn(){var e=Xt.time-1e3*Qt(),t=Xt.time-1e3*Gt();for(var n=0;n<c;n++){var r=Xt.clients[n];if(!r)continue;r.lastPacketTime>Xt.time&&(r.lastPacketTime=Xt.time);if(r.state===Ft.ZOMBIE&&r.lastPacketTime<t){Yt("Going from CS_ZOMBIE to CS_FREE for client",n),r.state=Ft.FREE;continue}r.state>=Ft.CONNECTED&&r.lastPacketTime<e&&(dn(r,"timed out"),r.state=Ft.FREE)}}function rn(e,n){if(!Xt.initialized)return;var r=new t(n,t.LITTLE_ENDIAN);if(n.byteLength>4&&r.view.getInt32(0,!!t.LITTLE_ENDIAN)===-1){sn(e,r);return}for(var i=0;i<Xt.clients.length;i++){var s=Xt.clients[i];if(s.state===Ft.FREE)continue;if(s.netchan.socket!==e)continue;Ut.NetchanProcess(s,r)&&(s.lastPacketTime=Xt.time,xn(s,r));return}}function sn(e,t){t.readInt();var n=t.readCString();n.indexOf("connect")===0&&pn(e,n.substr(8))}function on(e){Yt("Spawning new server for "+e),Xt.initialized=!1,n.Shutdown(),zt||(r.MapLoading(),r.ShutdownCGame(),r.ShutdownRenderer(),r.InitRenderer()),Xt.snapFlagServerBit^=l;var t=Wt.time;Wt=new Bt,Vt.LoadMap(e,function(){Jt(e),$t(Xt.frameTime),zn(),Wt.state=Ht.LOADING;var t={LocateGameData:Mn,GetUserCommand:_n,GetConfigstring:un,SetConfigstring:an,GetUserinfo:cn,SetBrushModel:Dn,LinkEntity:$n,UnlinkEntity:Jn,FindEntitiesInBox:Xn,GetEntityDefs:Vt.EntityDefs,Trace:Kn};n.Init(Ut,t);for(var r=0;r<c;r++){var i=Xt.clients[r];if(!i||i.state<Ft.CONNECTED)continue;i.gentity=null;var s=n.ClientConnect(r,!1);s&&dn(i,s),i.state=Ft.CONNECTED}an("systemInfo",Ut.GetCvarKeyValues(S.SYSTEMINFO)),an("serverInfo",Ut.GetCvarKeyValues(S.SERVERINFO)),Wt.state=Ht.GAME,Xt.initialized=!0})}function un(e){return Wt.configstrings[e]}function an(t,n){if(e.isEqual(n,Wt.configstrings[t]))return;Wt.configstrings[t]=n;if(Wt.state===Ht.GAME||Wt.restarting)for(var r=0;r<c;r++){var i=Xt.clients[r];if(i.state<Ft.ACTIVE){i.state===Ft.PRIMED&&(i.csUpdated[t]=!0);continue}fn(i,t)}}function fn(e,t){}function ln(e){for(var t in Wt.configstrings){if(!Wt.configstrings.hasOwnProperty(t))continue;if(!e.csUpdated[t])continue;fn(e,t),e.csUpdated[t]=!1}}function cn(e){return(e<0||e>=c)&&Ut.error(u.DROP,"GetUserinfo: bad index "+e),Xt.clients[e].userinfo}function hn(e){for(var t=0;t<Xt.clients.length;t++){var n=Xt.clients[t];if(n.state===Ft.FREE)continue;if(n.netchan.socket===e){dn(n,"disconnected");return}}}function pn(e,t){if(!Xt.initialized)return;Yt("A client is connecting");var r;for(var i=0;i<c;i++)if(Xt.clients[i].state===Ft.FREE){r=i;break}if(r===undefined){Yt("Rejected a connection.");return}var s=Xt.clients[r];s.netchan=Ut.NetchanSetup(b.SERVER,e),s.userinfo=JSON.parse(t);var o=n.ClientConnect(r,!0);if(o)return;bn(s),Yt("Going from CS_FREE to CS_CONNECTED for ",r),s.state=Ft.CONNECTED,s.lastSnapshotTime=Xt.time,s.lastPacketTime=Xt.time,Ut.NetchanPrint(s.netchan,"connectResponse"),s.gamestateMessageNum=-1}function dn(e,t){if(e.state===Ft.ZOMBIE)return;var r=wn(e);n.ClientDisconnect(r),e.state=Ft.ZOMBIE}function vn(e){var t=Xt.clients.indexOf(e);e.state=Ft.ACTIVE,ln(e),n.ClientBegin(t),e.gentity=Ln(t)}function mn(e,t,n){var r=new N;r.serverTime=t.readInt(),r.angles[0]=t.readUnsignedShort(),r.angles[1]=t.readUnsignedShort(),r.angles[2]=t.readUnsignedShort(),r.forwardmove=t.readByte(),r.rightmove=t.readByte(),r.upmove=t.readByte(),e.state===Ft.PRIMED&&vn(e);if(e.state!==Ft.ACTIVE)return;gn(e,r)}function gn(e,t){var r=wn(e);t.clone(e.lastUserCmd),n.ClientThink(r)}function yn(e){e.state=Ft.PRIMED,e.gamestateMessageNum=e.netchan.outgoingSequence;var n=new t(Xt.msgBuffer,t.LITTLE_ENDIAN);n.writeInt(e.lastClientCommand),n.writeByte(Ct.gamestate);for(var r in Wt.configstrings){if(!Wt.configstrings.hasOwnProperty(r))continue;var i=Wt.configstrings[r];n.writeByte(Ct.configstring),n.writeCString(r),n.writeCString(JSON.stringify(i))}n.writeByte(Ct.EOF),n.writeInt(wn(e)),Ut.NetchanSend(e.netchan,n.buffer,n.index)}function bn(e){e.name=e.userinfo.name;var t=20;t<1?t=1:t>Kt()&&(t=Kt()),t=1e3/t,t!=e.snapshotMsec&&(e.lastSnapshotTime=0,e.snapshotMsec=t)}function wn(e){return Xt.clients.indexOf(e)}function En(e,t){e.userinfo=JSON.parse(t),bn(e);var r=wn(e);n.ClientUserinfoChanged(r)}function Sn(e){dn(e,"disconnected")}function xn(e,t){var n=t.readInt();e.messageAcknowledge=t.readInt();if(e.messageAcknowledge<0)return;e.reliableAcknowledge=t.readInt();if(e.reliableAcknowledge<e.reliableSequence-St){e.reliableAcknowledge=e.reliableSequence;return}if(n!==$t()){e.messageAcknowledge>e.gamestateMessageNum&&yn(e);return}e.oldServerTime&&n===$t()&&(e.oldServerTime=0);var r;for(;;){r=t.readUnsignedByte();if(r===Nt.EOF)break;if(r!==Nt.clientCommand)break;if(!Tn(e,t))return;if(e.state===Ft.ZOMBIE)return}switch(r){case Nt.move:mn(e,t,!0);break;case Nt.moveNoDelta:mn(e,t,!1)}}function Tn(e,t){var n=t.readInt(),r=t.readCString();return e.lastClientCommand>=n?!0:n>e.lastClientCommand+1?(dn(e,"Lost reliable commands"),!1):(e.nextReliableTime=Xt.time+1e3,Nn(e,r),e.lastClientCommand=n,e.lastClientCommandString=r,!0)}function Nn(e,t){t.indexOf("userinfo")===0?UpdateUserInfo(e,t.substr(9)):t==="disconnect"&&Sn(e)}function Cn(){Ut.AddCmd("map",kn),Ut.AddCmd("sectorlist",Un)}function kn(e){on(e)}function Ln(e){return Wt.gameEntities[e]}function An(e){var t=e.s.number;(!e||t<0||t>=h)&&Ut.error(u.DROP,"SvEntityForSharedEntity: bad game entity");var n=Wt.svEntities[t];return n||(n=Wt.svEntities[t]=new jt(t)),n}function On(e){var t=e.number;return(!e||t<0||t>=h)&&Ut.error(u.DROP,"SharedEntityForSvEntity: bad sv entity"),Wt.gameEntities[t]}function Mn(e,t){Wt.gameEntities=e,Wt.gameClients=t}function _n(e,t){(e<0||e>=c)&&Ut.error(u.DROP,"GetUsercmd: bad clientNum: "+e),Xt.clients[e].lastUserCmd.clone(t)}function Dn(e,t){t||Ut.error(u.DROP,"SV: SetBrushModel: null"),t.charAt(0)!=="*"&&Ut.error(u.DROP,"SV: SetBrushModel: "+t+"isn't a brush model"),e.s.modelindex=parseInt(t.substr(1),10);var n=Vt.InlineModel(e.s.modelindex);Vt.ModelBounds(n,e.mins,e.maxs),e.bmodel=!0,e.contents=-1}function Pn(e,t){var r=e.gentity;if(!r||e.state===Ft.ZOMBIE)return!1;Wt.snapshotCounter++;var i=e.frames[e.netchan.outgoingSequence%wt],s=wn(e);i.ps=n.GetClientPlayerstate(s);var o=[];Hn(i.ps.origin,i,o,!1),i.numEntities=0,i.firstEntity=Xt.nextSnapshotEntities;for(var u=0;u<o.length;u++){var a=Ln(o[u]),f=Xt.snapshotEntities[Xt.nextSnapshotEntities%Dt];a.s.clone(f),Xt.nextSnapshotEntities++,i.numEntities++}return!0}function Hn(e,t,n,r){for(var i=0;i<h;i++){var s=Ln(i);if(!s||!s.linked)continue;s.s.number!==i&&Ut.error(u.DROP,"Entity number does not match.. WTF");if(s.svFlags&At.NOCLIENT)continue;if(s.svFlags&At.SINGLECLIENT&&s.singleClient!=t.ps.clientNum)continue;if(s.svFlags&At.NOTSINGLECLIENT&&s.singleClient===t.ps.clientNum)continue;var o=An(s);if(o.snapshotCounter===Wt.snapshotCounter)continue;if(s.svFlags&At.BROADCAST){Bn(o,s,n);continue}Bn(o,s,n)}}function Bn(e,t,n){if(e.snapshotCounter===Wt.snapshotCounter)return;e.snapshotCounter=Wt.snapshotCounter,n.push(t.s.number)}function jn(e){if(!Pn(e))return;var n=e.frames[e.netchan.outgoingSequence%wt],r=new t(Xt.msgBuffer,t.LITTLE_ENDIAN);r.writeInt(e.lastClientCommand),r.writeUnsignedByte(Ct.snapshot);var i=Wt.time;e.oldServerTime&&(i=Wt.time+e.oldServerTime),r.writeInt(i);var s=Xt.snapFlagServerBit;e.state!==Ft.ACTIVE&&(s|=f),r.writeInt(s),r.writeInt(n.ps.clientNum),r.writeInt(n.ps.commandTime),r.writeInt(n.ps.pm_type),r.writeInt(n.ps.pm_flags),r.writeInt(n.ps.pm_time),r.writeInt(n.ps.gravity),r.writeInt(n.ps.speed),r.writeFloat(n.ps.origin[0]),r.writeFloat(n.ps.origin[1]),r.writeFloat(n.ps.origin[2]),r.writeFloat(n.ps.velocity[0]),r.writeFloat(n.ps.velocity[1]),r.writeFloat(n.ps.velocity[2]),r.writeFloat(n.ps.viewangles[0]),r.writeFloat(n.ps.viewangles[1]),r.writeFloat(n.ps.viewangles[2]),r.writeShort(n.ps.delta_angles[0]),r.writeShort(n.ps.delta_angles[1]),r.writeShort(n.ps.delta_angles[2]),r.writeInt(n.ps.speed),r.writeInt(n.ps.gravity),r.writeInt(n.ps.groundEntityNum),r.writeInt(n.ps.legsTimer),r.writeShort(n.ps.legsAnim),r.writeInt(n.ps.torsoTimer),r.writeShort(n.ps.torsoAnim),r.writeByte(n.ps.movementDir);for(var o=0;o<n.numEntities;o++){var u=Xt.snapshotEntities[(n.firstEntity+o)%Dt];r.writeInt(u.number),r.writeInt(u.eType),r.writeInt(u.eFlags),r.writeInt(u.pos.trType),r.writeInt(u.pos.trTime),r.writeInt(u.pos.trDuration),r.writeFloat(u.pos.trBase[0]),r.writeFloat(u.pos.trBase[1]),r.writeFloat(u.pos.trBase[2]),r.writeFloat(u.pos.trDelta[0]),r.writeFloat(u.pos.trDelta[1]),r.writeFloat(u.pos.trDelta[2]),r.writeInt(u.apos.trType),r.writeInt(u.apos.trTime),r.writeInt(u.apos.trDuration),r.writeFloat(u.apos.trBase[0]),r.writeFloat(u.apos.trBase[1]),r.writeFloat(u.apos.trBase[2]),r.writeFloat(u.apos.trDelta[0]),r.writeFloat(u.apos.trDelta[1]),r.writeFloat(u.apos.trDelta[2]),r.writeFloat(u.origin[0]),r.writeFloat(u.origin[1]),r.writeFloat(u.origin[2]),r.writeInt(u.groundEntityNum),r.writeInt(u.modelIndex),r.writeInt(u.modelIndex2),r.writeInt(u.solid),r.writeShort(u.legsAnim),r.writeShort(u.torsoAnim)}r.writeUnsignedInt(h-1),Ut.NetchanSend(e.netchan,r.buffer,r.index)}function Fn(){for(var e=0;e<Xt.clients.length;e++){var t=Xt.clients[e];if(!t)continue;if(!t.state)continue;if(Xt.time-t.lastSnapshotTime<t.snapshotMsec)continue;jn(t),t.lastSnapshotTime=Xt.time}}function Un(){for(var t=0;t<qn.length;t++){var n=qn[t];Yt("sector "+t+": "+e.keys(n.entities).length+" entities")}}function zn(){qn=[];var e=Vt.InlineModel(0),t=[0,0,0],n=[0,0,0];Vt.ModelBounds(e,t,n),Wn(0,t,n)}function Wn(e,t,n){var r=qn[qn.length]=new Rn;if(e===In)return r.axis=-1,r.children[0]=r.children[1]=null,r;var i=vec3.subtract(n,t,[0,0,0]);i[0]>i[1]?r.axis=0:r.axis=1;var s=vec3.create(t),o=vec3.create(t),u=vec3.create(n),a=vec3.create(n);return r.dist=.5*(n[r.axis]+t[r.axis]),u[r.axis]=o[r.axis]=r.dist,r.children[0]=Wn(e+1,o,a),r.children[1]=Wn(e+1,s,u),r}function Xn(e,t){var n=[],r=function(i){for(var s in i.entities){if(!i.entities.hasOwnProperty(s))continue;var o=i.entities[s],u=On(o);if(u.absmin[0]>t[0]||u.absmin[1]>t[1]||u.absmin[2]>t[2]||u.absmax[0]<e[0]||u.absmax[1]<e[1]||u.absmax[2]<e[2])continue;n.push(u.s.number)}if(i.axis==-1)return;t[i.axis]>i.dist&&r(i.children[0]),e[i.axis]<i.dist&&r(i.children[1])};return r(qn[0]),n}function Vn(e,t){var n=[0,0,0];for(var r=0;r<3;r++){var i=Math.abs(e[r]),s=Math.abs(t[r]);n[r]=i>s?i:s}return vec3.length(n)}function $n(e){var t=An(e);t.worldSector&&Jn(e);var n=e.currentOrigin,r=e.currentAngles;vec3.add(n,e.mins,e.absmin),vec3.add(n,e.maxs,e.absmax),e.absmin[0]-=1,e.absmin[1]-=1,e.absmin[2]-=1,e.absmax[0]+=1,e.absmax[1]+=1,e.absmax[2]+=1;var i=qn[0];for(;;){if(i.axis==-1)break;if(e.absmin[i.axis]>i.dist)i=i.children[0];else{if(!(e.absmax[i.axis]<i.dist))break;i=i.children[1]}}e.linked=!0,t.worldSector=i,i.entities[t.number]=t}function Jn(e){var t=An(e),n=t.worldSector;if(!n)return;e.linked=!1,delete n.entities[t.number],t.worldSector=null}function Kn(e,t,n,r,i,s,o){typeof n=="undefined"&&(n=[0,0,0]),typeof r=="undefined"&&(r=[0,0,0]);var u=Vt.BoxTrace(e,t,n,r,0,s,o);return u.entityNum=u.fraction!==1?d:p,u.fraction===0?u:u}var s="baseq3",o=64,u={FATAL:0,DROP:1,DISCONNECT:2},a=1,f=2,l=4,c=32,h=1024,p=h-1,d=h-2,v=h-2,m=256,g=256,y={NAD:0,LOOPBACK:1,IP:2},b={CLIENT:0,SERVER:1},w=function(e,t,n){this.type=e,this.ip=t,this.port=n},E=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},S={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},x={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},T=120,N=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};N.prototype.clone=function(e){return typeof e=="undefined"&&(e=new N),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var C=6,k=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=p,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};k.prototype.clone=function(e){return typeof e=="undefined"&&(e=new k),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var L={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},A=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};A.prototype.clone=function(e){return typeof e=="undefined"&&(e=new A),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var O=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},M=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new A,this.apos=new A,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=p,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};M.prototype.clone=function(e){return typeof e=="undefined"&&(e=new M),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var _=0,D=1,P=2,z=function(e){return e*65536/360&65535},W=function(e){return e*(360/65536)},X=0,V=1,$=2,J=3,K=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};K.prototype.clone=function(e){return typeof e=="undefined"&&(e=new K),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],tt={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},nt={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},rt=function(){this.fileofs=0,this.filelen=0},it=function(){this.ident=null,this.version=0,this.lumps=new Array(nt.NUM_LUMPS);for(var e=0;e<nt.NUM_LUMPS;e++)this.lumps[e]=new rt},st=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};st.size=40;var ot=function(){this.shaderName=null,this.flags=0,this.contents=0};ot.size=72;var ut=function(){this.normal=[0,0,0],this.dist=0};ut.size=16;var at=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};at.size=36;var ft=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};ft.size=48;var lt=function(){this.planeNum=0,this.shader=0};lt.size=8;var ct=function(){this.side=0,this.numsides=0,this.shader=0};ct.size=12;var ht=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};ht.size=72;var pt=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};pt.size=44;var dt={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},vt=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};vt.size=104;var yt=32,bt={NETCLMESSAGE:0,NETSVMESSAGE:1,NETSVSOCKETCLOSED:2,KEYDOWN:3,KEYUP:4,MOUSEMOVE:5},wt=32,Et=32,St=64,xt=16384,Tt=function(){this.src=0,this.remoteAddress=null,this.socket=null,this.incomingSequence=0,this.outgoingSequence=0},Nt={nop:0,move:1,moveNoDelta:2,clientCommand:3,EOF:4},Ct={gamestate:0,configstring:1,baseline:2,serverCommand:3,snapshot:4,EOF:5},kt=100,Lt=function(){this.framenum=0,this.previousTime=0,this.time=0,this.clients=new Array(c),this.gentities=new Array(h)},At={NOCLIENT:1,BOT:2,BROADCAST:8,PORTAL:32,USE_CURRENT_ORIGIN:64,SINGLECLIENT:128,NOTSINGLECLIENT:256},Ot=function(){this.s=new M,this.linked=!1,this.svFlags=0,this.singleClient=0,this.bmodel=!1,this.mins=[0,0,0],this.maxs=[0,0,0],this.contents=0,this.absmin=[0,0,0],this.absmax=[0,0,0],this.currentOrigin=[0,0,0],this.currentAngles=[0,0,0],this.client=null,this.classname="noclass",this.spawnflags=0,this.model=null,this.model2=null,this.target=null,this.targetname=null,this.nextthink=0},Mt=function(){this.ps=new k,this.pers=new _t},_t=function(){this.cmd=new N,this.netname=null},Dt=c*wt*64,Pt=function(){this.initialized=!1,this.time=0,this.snapFlagServerBit=0,this.clients=new Array(c),this.nextSnapshotEntities=0,this.snapshotEntities=new Array(Dt),this.msgBuffer=new ArrayBuffer(xt);for(var e=0;e<c;e++)this.clients[e]=new It;for(var e=0;e<Dt;e++)this.snapshotEntities[e]=new M},Ht={DEAD:0,LOADING:1,GAME:2},Bt=function(){this.state=Ht.DEAD,this.restarting=!1,this.serverId=0,this.snapshotCounter=0,this.time=0,this.timeResidual=0,this.configstrings={},this.svEntities=new Array(h),this.gameEntities=null,this.gameClients=null},jt=function(e){this.worldSector=null,this.baseline=new M,this.number=e,this.snapshotCounter=0},Ft={FREE:0,ZOMBIE:1,CONNECTED:2,PRIMED:3,ACTIVE:4},It=function(){this.state=Ft.FREE,this.userinfo={},this.messageAcknowledge=0,this.reliableCommands=new Array(St),this.reliableSequence=0,this.reliableAcknowledge=0,this.reliableSent=0,this.gamestateMessageNum=-1,this.lastUserCmd=new N,this.lastMessageNum=0,this.lastClientCommand=0,this.lastClientCommandString=null,this.name=null,this.deltaMessage=-1,this.nextReliableTime=0,this.lastSnapshotTime=0,this.snapshotMsec=0,this.frames=new Array(wt),this.netchan=null,this.oldServerTime=0,this.csUpdated={};for(var e=0;e<wt;e++)this.frames[e]=new k},qt=function(){this.ps=new k,this.numEntities=0,this.firstEntity=0},Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,In=4,qn,Rn=function(){this.axis=0,this.dist=0,this.children=[null,null],this.entities={}};return{Init:Zt,Frame:tn,PacketEvent:rn,SocketClosed:hn}}),define("common/com",["underscore","ByteBuffer","server/sv","client/cl"],function(e,t,n,r){function P(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function H(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function B(e,t,n){n[0]=H(e[0],t[0]),n[1]=H(e[1],t[1]),n[2]=H(e[2],t[2])}function j(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function F(e,t,n,r){var i,s,o,u,a,f,l;i=e[_]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[M]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[D]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function I(e,t){var n=[0,0,0];F(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function q(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function R(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function K(e){return e[0]==1?W:e[1]==1?X:e[2]==1?V:$}function Q(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function G(e,t,n){if(n.type<$)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function Z(e,t,n){var r=new Array(n),i=[].concat(Y),s=[].concat(Y),o=[].concat(Y),u=[].concat(Y),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function vt(e){return e<-128?-128:e>127?127:e}function mt(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function kt(){Lt("exec",Ot)}function Lt(e,t){Ct[e]=t}function At(e){return Ct[e]}function Ot(e){Ft.ReadFile(e,"utf8",function(t,n){if(t){console.warn("Failed to execute '"+e+"'");return}n=n.replace(/^\s+|\s+$/g,"");var r=n.split(/\r\n|\r|\n/);for(var i=0;i<r.length;i++)Jt(r[i])})}function _t(e,t,n){var r=new w(t,n||0);return Mt[e]=r,r}function Dt(e){return Mt[e]}function Pt(e){var t=Mt[e];return t?t():(console.warn("COM: No cvar found for '"+e+"'"),null)}function Ht(e,t){var n=Mt[e];if(!n){console.warn("COM: No cvar found for '"+e+"'");return}n(t)}function Bt(e){var t={};for(var n in Mt){if(!Mt.hasOwnProperty(n))continue;var r=Mt[n];if(!(r.flags&e))continue;t[n]=r()}return t}function jt(e){for(var t in Mt){if(!Mt.hasOwnProperty(t))continue;var n=Mt[t];if(!(n.flags&E.ARCHIVE))continue;e+=t+" "+n()+"\n"}return e}function zt(e,t){throw new Error(t)}function Wt(e,t){Ft=e,It=t,qt=[],Rt=Ut=Ft.GetMilliseconds(),kt();var i={error:zt,ExecuteCmdText:Jt,LoadConfig:Kt,SaveConfig:Qt,AddCvar:_t,GetCvarVal:Pt,SetCvarVal:Ht,GetCvarKeyValues:Bt,AddCmd:Lt,GetCmd:At,NetchanSetup:tn,NetchanDestroy:nn,NetchanSend:sn,NetchanPrint:on,NetchanProcess:un};n.Init(Ft,i,It),It||r.Init(Ft,i),Kt()}function Xt(){Ut=Rt,Rt=Ft.GetMilliseconds();var e=Rt-Ut;Vt(),n.Frame(Rt,e),It||r.Frame(Rt,e)}function Vt(){var e=qt.shift();while(e){switch(e.type){case yt.NETCLMESSAGE:r.PacketEvent(e.buffer);break;case yt.NETSVMESSAGE:n.PacketEvent(e.socket,e.buffer);break;case yt.NETSVSOCKETCLOSED:n.SocketClosed(e.socket);break;case yt.KEYDOWN:r.KeyDownEvent(e.time,e.keyName);break;case yt.KEYUP:r.KeyUpEvent(e.time,e.keyName);break;case yt.MOUSEMOVE:r.MouseMoveEvent(e.time,e.deltaX,e.deltaY)}e=qt.shift()}}function $t(e){e.time=Ft.GetMilliseconds(),qt.push(e)}function Jt(e){var t=e.split(" "),n=t[0],r=t.slice(1),i,s;(i=At(n))?i.apply(this,r):(s=Dt(n))&&s(r[0])}function Kt(){Jt("exec default.cfg")}function Qt(e){var t="unbindall\n";t=r.WriteBindings(t),t=jt(t),Ft.WriteFile("default.cfg",t,"utf8",e)}function tn(e,t){var n=new xt,r,i;return t.type!==undefined?(r=t,r.type===g.LOOPBACK?i={remoteAddress:r}:i=Ft.NetConnectToServer(r)):(i=t,r=i.remoteAddress),n.src=e,n.addr=r,n.socket=i,n}function nn(e){e.addr.type===g.LOOPBACK?$t({type:yt.NETSVCLOSED,socket:e.socket}):Ft.NetClose(e.socket)}function rn(e,t,n){var r=Zt[e.src];t=t.slice(0,n),r.msgs[r.send++%Yt]=t,$t({type:e.src===y.CLIENT?yt.NETSVMESSAGE:yt.NETCLMESSAGE,socket:e.socket,addr:e.addr,buffer:t,length:n})}function sn(e,n,r){var i=new t(en,t.LITTLE_ENDIAN),s=new Uint8Array(n);i.writeInt(e.outgoingSequence++);for(var o=0;o<r;o++)i.writeUnsignedByte(s[o]);if(e.addr.type===g.LOOPBACK){rn(e,i.buffer,i.index);return}Ft.NetSend(e.socket,i.buffer,i.index)}function on(e,n){var r=new t(en,t.LITTLE_ENDIAN);r.writeInt(-1),r.writeCString(n);if(e.addr.type===g.LOOPBACK){rn(e,r.buffer,r.index);return}Ft.NetSend(e.socket,r.buffer,r.index)}function un(e,t){var n=t.readInt();return e.incomingSequence=n,!0}var i="baseq3",s=64,o={FATAL:0,DROP:1,DISCONNECT:2},u=1,a=2,f=4,l=32,c=1024,h=c-1,p=c-2,d=c-2,v=256,m=256,g={NAD:0,LOOPBACK:1,IP:2},y={CLIENT:0,SERVER:1},b=function(e,t,n){this.type=e,this.ip=t,this.port=n},w=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},E={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},S={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},x=120,T=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};T.prototype.clone=function(e){return typeof e=="undefined"&&(e=new T),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var N=6,C=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=h,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};C.prototype.clone=function(e){return typeof e=="undefined"&&(e=new C),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var k={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},L=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};L.prototype.clone=function(e){return typeof e=="undefined"&&(e=new L),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var A=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},O=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new L,this.apos=new L,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=h,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};O.prototype.clone=function(e){return typeof e=="undefined"&&(e=new O),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var M=0,_=1,D=2,U=function(e){return e*65536/360&65535},z=function(e){return e*(360/65536)},W=0,X=1,V=2,$=3,J=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};J.prototype.clone=function(e){return typeof e=="undefined"&&(e=new J),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],et={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},tt={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},nt=function(){this.fileofs=0,this.filelen=0},rt=function(){this.ident=null,this.version=0,this.lumps=new Array(tt.NUM_LUMPS);for(var e=0;e<tt.NUM_LUMPS;e++)this.lumps[e]=new nt},it=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};it.size=40;var st=function(){this.shaderName=null,this.flags=0,this.contents=0};st.size=72;var ot=function(){this.normal=[0,0,0],this.dist=0};ot.size=16;var ut=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};ut.size=36;var at=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};at.size=48;var ft=function(){this.planeNum=0,this.shader=0};ft.size=8;var lt=function(){this.side=0,this.numsides=0,this.shader=0};lt.size=12;var ct=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};ct.size=72;var ht=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};ht.size=44;var pt={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},dt=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};dt.size=104;var gt=32,yt={NETCLMESSAGE:0,NETSVMESSAGE:1,NETSVSOCKETCLOSED:2,KEYDOWN:3,KEYUP:4,MOUSEMOVE:5},bt=32,wt=32,Et=64,St=16384,xt=function(){this.src=0,this.remoteAddress=null,this.socket=null,this.incomingSequence=0,this.outgoingSequence=0},Tt={nop:0,move:1,moveNoDelta:2,clientCommand:3,EOF:4},Nt={gamestate:0,configstring:1,baseline:2,serverCommand:3,snapshot:4,EOF:5},Ct={},Mt={},Ft,It=!1,qt,Rt,Ut,Gt=1400,Yt=16,Zt=[{msgs:new Array(Yt),send:0},{msgs:new Array(Yt),send:0}],en=new ArrayBuffer(St);return{EventTypes:yt,Init:Wt,Frame:Xt,ExecuteCmdText:Jt,QueueEvent:$t,NetchanSetup:tn}}),define("system/dedicated/sys",["common/com"],function(e){function M(e,t,n){return t-e>180&&(t-=360),t-e<-180&&(t+=360),e+n*(t-e)}function _(e,t){var n=e-t;while(n>180)n-=360;while(n<-180)n+=360;return n}function D(e,t,n){n[0]=_(e[0],t[0]),n[1]=_(e[1],t[1]),n[2]=_(e[2],t[2])}function P(e){return e=360/65536*(parseInt(e*(65536/360),10)&65535),e}function H(e,t,n,r){var i,s,o,u,a,f,l;i=e[A]*(Math.PI*2/360),u=Math.sin(i),l=Math.cos(i),i=e[L]*(Math.PI*2/360),o=Math.sin(i),f=Math.cos(i),i=e[O]*(Math.PI*2/360),s=Math.sin(i),a=Math.cos(i),t&&(t[0]=f*l,t[1]=f*u,t[2]=-o),n&&(n[0]=-1*s*o*l+ -1*a*-u,n[1]=-1*s*o*u+ -1*a*l,n[2]=-1*s*f),r&&(r[0]=a*o*l+ -s*-u,r[1]=a*o*u+ -s*l,r[2]=a*f)}function B(e,t){var n=[0,0,0];H(e,t[0],n,t[2]),vec3.subtract([0,0,0],n,t[1])}function j(e){e[0][0]=1,e[0][1]=0,e[0][2]=0,e[1][0]=0,e[1][1]=1,e[1][2]=0,e[2][0]=0,e[2][1]=0,e[2][2]=1}function F(e,t,n){n[0][0]=e[0][0]*t[0][0]+e[0][1]*t[1][0]+e[0][2]*t[2][0],n[0][1]=e[0][0]*t[0][1]+e[0][1]*t[1][1]+e[0][2]*t[2][1],n[0][2]=e[0][0]*t[0][2]+e[0][1]*t[1][2]+e[0][2]*t[2][2],n[1][0]=e[1][0]*t[0][0]+e[1][1]*t[1][0]+e[1][2]*t[2][0],n[1][1]=e[1][0]*t[0][1]+e[1][1]*t[1][1]+e[1][2]*t[2][1],n[1][2]=e[1][0]*t[0][2]+e[1][1]*t[1][2]+e[1][2]*t[2][2],n[2][0]=e[2][0]*t[0][0]+e[2][1]*t[1][0]+e[2][2]*t[2][0],n[2][1]=e[2][0]*t[0][1]+e[2][1]*t[1][1]+e[2][2]*t[2][1],n[2][2]=e[2][0]*t[0][2]+e[2][1]*t[1][2]+e[2][2]*t[2][2]}function V(e){return e[0]==1?R:e[1]==1?U:e[2]==1?z:W}function $(e){var t=0;for(var n=0;n<3;n++)e.normal[n]<0&&(t|=1<<n);return t}function J(e,t,n){if(n.type<W)return n.dist<=e[n.type]?1:n.dist>=t[n.type]?2:3;var r=[0,0];if(n.signbits<8)for(var i=0;i<3;i++){var s=n.signbits>>i&1;r[s]+=n.normal[i]*t[i],r[s^1]+=n.normal[i]*e[i]}var o=0;return r[0]>=n.dist&&(o=1),r[1]<n.dist&&(o|=2),o}function Q(e,t,n){var r=new Array(n),i=[].concat(K),s=[].concat(K),o=[].concat(K),u=[].concat(K),a=0,f,l=0,c,h=0,p,d=0,v,m;for(m=0;m<n;m++)f=e[m][t]&255,c=e[m][t]>>8&255,p=e[m][t]>>16&255,v=e[m][t]>>24&255^128,i[f]++,s[c]++,o[p]++,u[v]++;for(m=0;m<256;m++)f=a+i[m],c=l+s[m],p=h+o[m],v=d+u[m],i[m]=a,s[m]=l,o[m]=h,u[m]=d,a=f,l=c,h=p,d=v;for(m=0;m<n;m++)f=e[m][t]&255,r[i[f]]=e[m],i[f]++;for(m=0;m<n;m++)c=r[m][t]>>8&255,e[s[c]]=r[m],s[c]++;for(m=0;m<n;m++)p=e[m][t]>>16&255,r[o[p]]=e[m],o[p]++;for(m=0;m<n;m++)v=r[m][t]>>24&255^128,e[u[v]]=r[m],u[v]++;return e}function ht(e){return e<-128?-128:e>127?127:e}function pt(e){var t=65536,n=e.length,r=e.slice||e.subarray,i;if(n<t)i=String.fromCharCode.apply(String,e);else{var s=[],o=0;while(o<n)s.push(String.fromCharCode.apply(String,r.call(e,o,o+t))),o+=t;i=s.join("")}return btoa(i)}function vt(){var e=Array.prototype.slice.call(arguments);e.splice(0,0,"SYS:"),Function.apply.call(console.log,console,e)}function mt(e){throw new Error(e)}function gt(t){kt(),e.Init(Mt,!0),setInterval(function(){e.Frame()},10)}function yt(){mt("Should not happen")}function bt(){mt("Should not happen")}function wt(){mt("Should not happen")}function St(){var e=process.hrtime();return Et||(Et=e[0]*1e3+parseInt(e[1]/1e6,10)),e[0]*1e3+parseInt(e[1]/1e6,10)-Et}function Tt(e,n,r){var i=n==="binary";if(i){xt.readFile(t+"/"+e,function(e,t){if(e)return r(e);var n=new ArrayBuffer(t.length),i=new Uint8Array(n);for(var s=0;s<t.length;++s)i[s]=t[s];r(null,n)});return}xt.readFile(t+"/"+e,"utf8",function(e,t){if(e)throw e;r(null,t)})}function kt(){var t=Nt.createServer(),n=new Ct({httpServer:t,autoAcceptConnections:!1});t.listen(9001,function(){vt(new Date+" Server is listening on port 8080")}),n.on("request",function(t){var n=t.accept("q3js",t.origin);vt(new Date+" Connection accepted."),e.QueueEvent({type:e.EventTypes.NETSVCONNECT,socket:n}),n.on("message",function(t){var r=t.binaryData,i=new ArrayBuffer(r.length),s=new Uint8Array(i);for(var o=0;o<r.length;++o)s[o]=r[o];e.QueueEvent({type:e.EventTypes.NETSVMESSAGE,socket:n,buffer:i})}),n.on("close",function(t,r){e.QueueEvent({type:e.EventTypes.NETSVSOCKETCLOSED,socket:n})})})}function Lt(e){mt("Should not happen")}function At(e,t,n){var r=new Buffer(n),i=new Uint8Array(t);for(var s=0;s<n;++s)r[s]=i[s];e.sendBytes(r)}function Ot(e){e.close()}var t="baseq3",n=64,r={FATAL:0,DROP:1,DISCONNECT:2},i=1,s=2,o=4,u=32,a=1024,f=a-1,l=a-2,c=a-2,h=256,p=256,d={NAD:0,LOOPBACK:1,IP:2},v={CLIENT:0,SERVER:1},m=function(e,t,n){this.type=e,this.ip=t,this.port=n},g=function(e,t){var n=e,r=function(t){if(!arguments.length)return n;var r=n;typeof e=="string"?n=t.toString():e%1===0?n=parseInt(t,10):n=parseFloat(t)};return r.flags=t,r},y={ARCHIVE:1,USERINFO:2,SERVERINFO:4,SYSTEMINFO:8},b={ATTACK:1,TALK:2,USE_HOLDABLE:4,GESTURE:8,WALKING:16,AFFIRMATIVE:32,NEGATIVE:64,GETFLAG:128,GUARDBASE:256,PATROL:512,FOLLOWME:1024,ANY:2048},w=120,E=function(){this.serverTime=0,this.angles=[0,0,0],this.buttons=0,this.forwardmove=0,this.rightmove=0,this.upmove=0};E.prototype.clone=function(e){return typeof e=="undefined"&&(e=new E),e.serverTime=this.serverTime,vec3.set(this.angles,e.angles),e.buttons=this.buttons,e.forwardmove=this.forwardmove,e.rightmove=this.rightmove,e.upmove=this.upmove,e};var S=6,x=function(){this.clientNum=0,this.commandTime=0,this.pm_type=0,this.pm_flags=0,this.origin=[0,0,0],this.velocity=[0,0,0],this.viewangles=[0,0,0],this.delta_angles=[0,0,0],this.speed=0,this.gravity=0,this.groundEntityNum=f,this.legsTimer=0,this.legsAnim=0,this.torsoTimer=0,this.torsoAnim=0,this.movementDir=0,this.jumppad_ent=0,this.jumppad_frame=0,this.pmove_framecount=0};x.prototype.clone=function(e){return typeof e=="undefined"&&(e=new x),e.clientNum=this.clientNum,e.commandTime=this.commandTime,e.pm_type=this.pm_type,e.pm_flags=this.pm_flags,vec3.set(this.origin,e.origin),vec3.set(this.velocity,e.velocity),vec3.set(this.viewangles,e.viewangles),vec3.set(this.delta_angles,e.delta_angles),e.speed=this.speed,e.gravity=this.gravity,e.groundEntityNum=this.groundEntityNum,e.legsTimer=this.legsTimer,e.legsAnim=this.legsAnim,e.torsoTimer=this.torsoTimer,e.torsoAnim=this.torsoAnim,e.movementDir=this.movementDir,e.jumppad_ent=this.jumppad_ent,e.jumppad_frame=this.jumppad_frame,e.pmove_framecount=this.pmove_framecount,e};var T={STATIONARY:0,INTERPOLATE:1,LINEAR:2,LINEAR_STOP:3,SINE:4,GRAVITY:5},N=function(){this.trType=0,this.trTime=0,this.trDuration=0,this.trBase=[0,0,0],this.trDelta=[0,0,0]};N.prototype.clone=function(e){return typeof e=="undefined"&&(e=new N),e.trType=this.trType,e.trTime=this.trTime,e.trDuration=this.trDuration,vec3.set(this.trBase,e.trBase),vec3.set(this.trDelta,e.trDelta),e};var C=function(){this.origin=vec3.create(),this.axis=[[0,0,0],[0,0,0],[0,0,0]],this.viewOrigin=vec3.create(),this.modelMatrix=mat4.create()},k=function(){this.number=0,this.eType=0,this.eFlags=0,this.pos=new N,this.apos=new N,this.time=0,this.time2=0,this.origin=[0,0,0],this.origin2=[0,0,0],this.angles=[0,0,0],this.angles2=[0,0,0],this.groundEntityNum=f,this.modelIndex=0,this.modelIndex2=0,this.clientNum=0,this.frame=0,this.solid=0,this.event=0,this.eventParm=0,this.legsAnim=0,this.torsoAnim=0};k.prototype.clone=function(e){return typeof e=="undefined"&&(e=new k),e.number=this.number,e.eType=this.eType,e.eFlags=this.eFlags,this.pos.clone(e.pos),this.apos.clone(e.apos),e.time=this.time,e.time2=this.time2,vec3.set(this.origin,e.origin),vec3.set(this.origin2,e.origin2),vec3.set(this.angles,e.angles),vec3.set(this.angles2,e.angles2),e.groundEntityNum=this.groundEntityNum,e.modelIndex=this.modelIndex,e.modelindex2=this.modelIndex2,e.clientNum=this.clientNum,e.frame=this.frame,e.solid=this.solid,e.event=this.event,e.eventParm=this.eventParm,e.legsAnim=this.legsAnim,e.torsoAnim=this.torsoAnim,e};var L=0,A=1,O=2,I=function(e){return e*65536/360&65535},q=function(e){return e*(360/65536)},R=0,U=1,z=2,W=3,X=function(){this.normal=vec3.create(),this.dist=0,this.type=0,this.signbits=0};X.prototype.clone=function(e){return typeof e=="undefined"&&(e=new X),vec3.set(this.normal,e.normal),e.dist=this.dist,e.type=this.type,e.signbits=this.signbits,e};var K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],G={NODAMAGE:1,SLICK:2,SKY:4,LADDER:8,NOIMPACT:16,NOMARKS:32,FLESH:64,NODRAW:128,HINT:256,SKIP:512,NOLIGHTMAP:1024,POINTLIGHT:2048,METALSTEPS:4096,NOSTEPS:8192,NONSOLID:16384,LIGHTFILTER:32768,ALPHASHADOW:65536,NODLIGHT:131072,DUST:262144},Y={ENTITIES:0,SHADERS:1,PLANES:2,NODES:3,LEAFS:4,LEAFSURFACES:5,LEAFBRUSHES:6,MODELS:7,BRUSHES:8,BRUSHSIDES:9,DRAWVERTS:10,DRAWINDEXES:11,FOGS:12,SURFACES:13,LIGHTMAPS:14,LIGHTGRID:15,VISIBILITY:16,NUM_LUMPS:17},Z=function(){this.fileofs=0,this.filelen=0},et=function(){this.ident=null,this.version=0,this.lumps=new Array(Y.NUM_LUMPS);for(var e=0;e<Y.NUM_LUMPS;e++)this.lumps[e]=new Z},tt=function(){this.mins=[0,0,0],this.maxs=[0,0,0],this.firstSurface=0,this.numSurfaces=0,this.firstBrush=0,this.numBrushes=0};tt.size=40;var nt=function(){this.shaderName=null,this.flags=0,this.contents=0};nt.size=72;var rt=function(){this.normal=[0,0,0],this.dist=0};rt.size=16;var it=function(){this.planeNum=0,this.childrenNum=[0,0],this.mins=[0,0,0],this.maxs=[0,0,0]};it.size=36;var st=function(){this.cluster=0,this.area=0,this.mins=[0,0,0],this.maxs=[0,0,0],this.firstLeafSurface=0,this.numLeafSurfaces=0,this.firstLeafBrush=0,this.numLeafBrushes=0};st.size=48;var ot=function(){this.planeNum=0,this.shader=0};ot.size=8;var ut=function(){this.side=0,this.numsides=0,this.shader=0};ut.size=12;var at=function(){this.shader=null,this.brushNum=0,this.visibleSide=0};at.size=72;var ft=function(){this.pos=[0,0,0],this.texCoord=[0,0],this.lmCoord=[0,0],this.normal=[0,0,0],this.color=[0,0,0,0]};ft.size=44;var lt={BAD:0,PLANAR:1,PATCH:2,TRIANGLE_SOUP:3,FLARE:4},ct=function(){this.shaderNum=0,this.fogNum=0,this.surfaceType=0,this.vertex=0,this.vertCount=0,this.meshVert=0,this.meshVertCount=0,this.lightmapNum=0,this.lmStart=[0,0],this.lmSize=[0,0],this.lmOrigin=[0,0,0],this.lmVecs=[[0,0,0],[0,0,0],[0,0,0]],this.patchWidth=0,this.patchHeight=0};ct.size=104;var dt={us:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,"break":19,capslock:20,escape:27,esc:27,space:32,spacebar:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,windows:91,win:91,_91:92,select:93,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,num:144,scrolllock:145,scroll:145,semicolon:186,equal:187,equalsign:187,comma:188,dash:189,period:190,slash:191,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222}},Et,xt=require("fs"),Nt=require("http"),Ct=require("websocket").server,Mt={GetMilliseconds:St,ReadFile:Tt,GetGLContext:bt,GetUIContext:wt,NetCreateServer:kt,NetConnectToServer:Lt,NetSend:At,NetClose:Ot};return{Init:gt}})